"use strict";(globalThis.webpackChunkmithril_doc=globalThis.webpackChunkmithril_doc||[]).push([[4811,5473],{3393(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"compiled-binaries","title":"compiled-binaries","description":"You can install a the latest released binary of the {props.node} by running this one line command (replace **YOURPATH with your installation path_):","source":"@site/root/compiled-binaries.mdx","sourceDirName":".","slug":"/compiled-binaries","permalink":"/doc/next/compiled-binaries","draft":false,"unlisted":true,"editUrl":"https://github.com/input-output-hk/mithril/edit/main/docs/website/root/compiled-binaries.mdx","tags":[],"version":"current","frontMatter":{"unlisted":true,"hide_title":true,"hide_table_of_contents":true}}');var s=r(74848),t=r(28453),o=r(83457);const l={unlisted:!0,hide_title:!0,hide_table_of_contents:!0},a=void 0,c={},d=[];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",li:"li",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.p,{children:["You can install a the ",(0,s.jsx)(n.strong,{children:"latest"})," released binary of the ",(0,s.jsx)(n.strong,{children:e.node})," by running this one line command (",(0,s.jsxs)(n.em,{children:["replace ",(0,s.jsx)(n.strong,{children:"YOUR_PATH"})," with your installation path"]}),"):"]}),"\n",(0,s.jsx)(o.A,{language:"bash",children:(0,s.jsxs)(n.p,{children:["curl --proto '=https' --tlsv1.2 -sSf\n",(0,s.jsx)(n.a,{href:"https://raw.githubusercontent.com/input-output-hk/mithril/refs/heads/main/mithril-install.sh",children:"https://raw.githubusercontent.com/input-output-hk/mithril/refs/heads/main/mithril-install.sh"}),"\n| sh -s -- -c ",e.node," -d latest -p ",(0,s.jsx)(n.strong,{children:"YOUR_PATH"})]})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["You can also install the ",(0,s.jsx)(n.strong,{children:e.node})," binary for other distributions:"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["use ",(0,s.jsx)(n.code,{children:"-d unstable"})," for the ",(0,s.jsx)(n.strong,{children:"unstable"})," version"]}),"\n",(0,s.jsxs)(n.li,{children:["use ",(0,s.jsx)(n.code,{children:"-d **DISTRIBUTION_VERSION**"})," for a specific distribution (e.g. ",(0,s.jsx)(n.code,{children:"-d 2445.0"}),")"]}),"\n"]})]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["The Linux binaries target ",(0,s.jsx)(n.code,{children:"glibc"}),", and have a minimum requirement of ",(0,s.jsx)(n.code,{children:"glibc 2.35"})," (compatible with ",(0,s.jsx)(n.code,{children:"Ubuntu 22.04"}),"\nor ",(0,s.jsx)(n.code,{children:"Debian 12 - Bookworm"}),")."]})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},96186(e,n,r){r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"manual/operate/run-signer-node","title":"Run a Mithril signer node","description":"For more information about the Mithril protocol, see the About Mithril section.","source":"@site/root/manual/operate/run-signer-node.md","sourceDirName":"manual/operate","slug":"/manual/operate/run-signer-node","permalink":"/doc/next/manual/operate/run-signer-node","draft":false,"unlisted":false,"editUrl":"https://github.com/input-output-hk/mithril/edit/main/docs/website/root/manual/operate/run-signer-node.md","tags":[],"version":"current","sidebarPosition":3,"frontMatter":{"sidebar_position":3},"sidebar":"manualSideBar","previous":{"title":"Become a Mithril SPO","permalink":"/doc/next/manual/operate/become-mithril-spo"},"next":{"title":"Run a Mithril aggregator node","permalink":"/doc/next/manual/operate/run-aggregator-node"}}');var s=r(74848),t=r(28453),o=r(3393);const l={sidebar_position:3},a="Run a Mithril signer node",c={},d=[{value:"Mithril signer deployment model",id:"mithril-signer-deployment-model",level:2},{value:"Mithril keys certification",id:"mithril-keys-certification",level:2},{value:"Mithril signer footprint",id:"mithril-signer-footprint",level:2},{value:"Cardano transactions certification footprint",id:"cardano-transactions-certification-footprint",level:3},{value:"CPU",id:"cpu",level:4},{value:"Memory",id:"memory",level:4},{value:"Disk",id:"disk",level:4},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Set up the Mithril signer node",id:"set-up-the-mithril-signer-node",level:2},{value:"Building your own executable",id:"building-your-own-executable",level:3},{value:"Download the source file",id:"download-the-source-file",level:4},{value:"Build the Mithril signer binary",id:"build-the-mithril-signer-binary",level:4},{value:"Download the pre-built binary",id:"download-the-pre-built-binary",level:3},...o.toc,{value:"Verifying the binary",id:"verifying-the-binary",level:3},{value:"Verify the version of the binary",id:"verify-the-version-of-the-binary",level:4},{value:"Verify the build",id:"verify-the-build",level:4},{value:"Installing the service",id:"installing-the-service",level:3},{value:"Move the executable",id:"move-the-executable",level:4},{value:"Set up the service",id:"set-up-the-service",level:4},{value:"Activate a Prometheus endpoint",id:"activate-a-prometheus-endpoint",level:3},{value:"Rotating the KES keys",id:"rotating-the-kes-keys",level:3},{value:"Set up the Mithril relay node",id:"set-up-the-mithril-relay-node",level:2},{value:"Building Squid from source",id:"building-squid-from-source",level:3},{value:"Configuring the Squid proxy",id:"configuring-the-squid-proxy",level:3},{value:"Installing the service",id:"installing-the-service-1",level:3},{value:"Firewall configuration",id:"firewall-configuration",level:3},{value:"About the Cardano relay machine",id:"about-the-cardano-relay-machine",level:4},{value:"Set up the DMQ node (unstable)",id:"set-up-the-dmq-node-unstable",level:2},{value:"Download the pre-built binary",id:"download-the-pre-built-binary-1",level:3},{value:"Installing the service",id:"installing-the-service-2",level:3},{value:"Move the executable",id:"move-the-executable-1",level:4},{value:"Prepare the configuration file of the DMQ node",id:"prepare-the-configuration-file-of-the-dmq-node",level:4},{value:"Prepare the topology file for the DMQ node",id:"prepare-the-topology-file-for-the-dmq-node",level:4},{value:"Set up the service",id:"set-up-the-service-1",level:4},{value:"Update the configuration of the Mithril signer",id:"update-the-configuration-of-the-mithril-signer",level:3},{value:"Firewall configuration",id:"firewall-configuration-1",level:3},{value:"Verify the Mithril signer deployment",id:"verify-the-mithril-signer-deployment",level:2},{value:"Verify your signer is registered",id:"verify-your-signer-is-registered",level:3},{value:"Verify your signer contributes with individual signatures",id:"verify-your-signer-contributes-with-individual-signatures",level:3}];function h(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"run-a-mithril-signer-node",children:"Run a Mithril signer node"})}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["For more information about the ",(0,s.jsx)(n.strong,{children:"Mithril protocol"}),", see the ",(0,s.jsx)(n.a,{href:"/doc/next/mithril/intro",children:"About Mithril"})," section."]})}),"\n",(0,s.jsx)(n.h2,{id:"mithril-signer-deployment-model",children:"Mithril signer deployment model"}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsxs)(n.p,{children:["In this guide, you will learn how to set up a ",(0,s.jsx)(n.strong,{children:"Mithril signer"})," within the stake pool operator (SPO) infrastructure, both on Cardano ",(0,s.jsx)(n.code,{children:"mainnet"})," and ",(0,s.jsx)(n.code,{children:"testnet"})," environments:"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["On ",(0,s.jsx)(n.code,{children:"mainnet"}),", you ",(0,s.jsx)(n.strong,{children:"must"})," run the ",(0,s.jsx)(n.strong,{children:"production"})," deployment where the ",(0,s.jsx)(n.strong,{children:"Mithril signer"})," runs on the ",(0,s.jsx)(n.strong,{children:"Cardano block producer"})," machine and the ",(0,s.jsx)(n.strong,{children:"Mithril relay"})," runs on the ",(0,s.jsx)(n.strong,{children:"Cardano relay"})," machine. ",(0,s.jsx)(n.strong,{children:"Note"})," that you can also run the ",(0,s.jsx)(n.strong,{children:"production"})," deployment on ",(0,s.jsx)(n.code,{children:"testnet"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["You can also run ",(0,s.jsx)(n.strong,{children:"naive"})," deployment, where the ",(0,s.jsx)(n.strong,{children:"Mithril signer"})," runs on the ",(0,s.jsx)(n.strong,{children:"Cardano relay"})," machine. This is possible in the testnet environment only, and does not require setting up a ",(0,s.jsx)(n.strong,{children:"Mithril relay"}),"."]}),"\n"]})]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"In the current setup, you don't need to install a Mithril aggregator."})}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"production"})," deployment model is currently in beta."]})}),"\n",(0,s.jsxs)(n.p,{children:["Below is the schema of the ",(0,s.jsx)(n.strong,{children:"production"})," deployment on mainnet:\n",(0,s.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:r(94974).A+"",children:(0,s.jsx)(n.img,{alt:"Production Mithril Signer Deployment Model",src:r(31146).A+"",width:"2208",height:"452"})})]}),"\n",(0,s.jsxs)(n.p,{children:["and the schema of the ",(0,s.jsx)(n.strong,{children:"naive"})," deployment specifically for ",(0,s.jsx)(n.code,{children:"testnets"}),":\n",(0,s.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:r(68880).A+"",children:(0,s.jsx)(n.img,{alt:"Naive Mithril Signer Deployment Model",src:r(23468).A+"",width:"2209",height:"452"})})]}),"\n",(0,s.jsx)(n.admonition,{type:"danger",children:(0,s.jsxs)(n.p,{children:["On ",(0,s.jsx)(n.code,{children:"mainnet"}),", you must ",(0,s.jsx)(n.strong,{children:"never"})," copy the ",(0,s.jsx)(n.code,{children:"KES secret key"})," from the ",(0,s.jsx)(n.strong,{children:"Cardano block producer"})," machine!"]})}),"\n",(0,s.jsx)(n.h2,{id:"mithril-keys-certification",children:"Mithril keys certification"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"Mithril signer"})," uses your Cardano ",(0,s.jsx)(n.code,{children:"operational certificate"})," and ",(0,s.jsx)(n.code,{children:"KES secret key"})," files, which enable:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Automatic computation of the ",(0,s.jsx)(n.code,{children:"PoolId"})]}),"\n",(0,s.jsxs)(n.li,{children:["Verification of your ",(0,s.jsx)(n.code,{children:"PoolId"})," ownership and the associated stake used by the Mithril protocol"]}),"\n",(0,s.jsxs)(n.li,{children:["Verification of your Mithril ",(0,s.jsx)(n.code,{children:"signer secret key"})," ownership, which allows you to participate in the multi-signature process for certificate production on the Mithril network."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"mithril-signer-footprint",children:"Mithril signer footprint"}),"\n",(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"Mithril signer"})," has been designed to have the lowest possible footprint in terms of CPU, memory, disk I/O, and storage.\nThus, there are no additional requirements for the recommended hardware to run a Cardano stake pool, as detailed in this ",(0,s.jsx)(n.a,{href:"https://developers.cardano.org/docs/operate-a-stake-pool/hardware-requirements",children:"guide"}),"."]}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsxs)(n.p,{children:["Here are some figures about the Mithril signer node running on Cardano ",(0,s.jsx)(n.code,{children:"mainnet"}),":"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["It is ",(0,s.jsx)(n.strong,{children:"idle"})," most of the time with a very low ",(0,s.jsx)(n.strong,{children:"CPU"})," usage of less than ",(0,s.jsx)(n.code,{children:"5%"})]}),"\n",(0,s.jsxs)(n.li,{children:["It uses less than ",(0,s.jsx)(n.code,{children:"200 MB"})," of ",(0,s.jsx)(n.strong,{children:"resident memory"})]}),"\n",(0,s.jsxs)(n.li,{children:["It sends a ",(0,s.jsx)(n.strong,{children:"new signature"})," to the aggregator roughly every ",(0,s.jsx)(n.code,{children:"10 minutes"})," and a ",(0,s.jsx)(n.strong,{children:"new registration"})," every ",(0,s.jsx)(n.code,{children:"5 days"})," (",(0,s.jsx)(n.code,{children:"<1 MB"})," per day)\nWhen launched for the ",(0,s.jsx)(n.strong,{children:"first time"}),", a ",(0,s.jsx)(n.strong,{children:"pre-loading"})," phase occurs, during which the Cardano transactions are imported with a spike of ",(0,s.jsx)(n.code,{children:"50-70%"})," CPU on one core for ",(0,s.jsx)(n.code,{children:"~5 hours"})]}),"\n",(0,s.jsxs)(n.li,{children:["When signing for the ",(0,s.jsx)(n.strong,{children:"first time"}),", the Cardano database digest cache needs to be built with a spike of ",(0,s.jsx)(n.code,{children:"50-70%"})," CPU on one core for ",(0,s.jsx)(n.code,{children:"~1 hour"})]}),"\n",(0,s.jsxs)(n.li,{children:["Also, the full Cardano database files will be ",(0,s.jsx)(n.strong,{children:"read from disk once"})," during this cache building process"]}),"\n",(0,s.jsxs)(n.li,{children:["Only ",(0,s.jsx)(n.strong,{children:"stake distributions"}),", ",(0,s.jsx)(n.strong,{children:"Mithril keys"}),", and some ",(0,s.jsx)(n.strong,{children:"cache"})," (for the ",(0,s.jsx)(n.strong,{children:"Cardano database"})," and ",(0,s.jsx)(n.strong,{children:"Cardano transactions"}),") are stored on the disk (",(0,s.jsx)(n.code,{children:"<200 MB"}),")."]}),"\n"]})]}),"\n",(0,s.jsx)(n.h3,{id:"cardano-transactions-certification-footprint",children:"Cardano transactions certification footprint"}),"\n",(0,s.jsxs)(n.p,{children:["Here is a detailed view of the Cardano transaction signature's impact (the most resource-intensive part of Mithril) on the SPO infrastructure on the ",(0,s.jsx)(n.code,{children:"mainnet"}),":"]}),"\n",(0,s.jsx)(n.h4,{id:"cpu",children:"CPU"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:r(29117).A+"",children:(0,s.jsx)(n.img,{alt:"Cardano transaction signer CPU",src:r(98817).A+"",width:"1675",height:"751"})})}),"\n",(0,s.jsx)(n.h4,{id:"memory",children:"Memory"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:r(48677).A+"",children:(0,s.jsx)(n.img,{alt:"Cardano transaction signer CPU",src:r(37769).A+"",width:"1675",height:"751"})})}),"\n",(0,s.jsx)(n.h4,{id:"disk",children:"Disk"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.a,{target:"_blank","data-noBrokenLinkCheck":!0,href:r(44142).A+"",children:(0,s.jsx)(n.img,{alt:"Cardano transaction signer CPU",src:r(9690).A+"",width:"1675",height:"751"})})}),"\n",(0,s.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsx)(n.p,{children:"Note that this guide works only on a Linux machine."})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["To operate a ",(0,s.jsx)(n.strong,{children:"Cardano node"})," as a ",(0,s.jsx)(n.strong,{children:"stake pool"}),", you need:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["The pool's ",(0,s.jsx)(n.code,{children:"operational certificate"})]}),"\n",(0,s.jsxs)(n.li,{children:["The pool's ",(0,s.jsx)(n.code,{children:"KES secret key"})]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["To access the file system of the ",(0,s.jsx)(n.strong,{children:"Cardano block-producing"})," node for ",(0,s.jsx)(n.strong,{children:"production"})," deployment (or of the ",(0,s.jsx)(n.strong,{children:"Cardano relay"})," node for ",(0,s.jsx)(n.strong,{children:"naive"})," deployment), you will need the following permissions:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Read rights on the ",(0,s.jsx)(n.code,{children:"Database"})," folder (specified by the ",(0,s.jsx)(n.code,{children:"--database-path"})," setting of the ",(0,s.jsx)(n.strong,{children:"Cardano node"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:["Read and write rights on the ",(0,s.jsx)(n.code,{children:"Inter Process Communication"})," file (typically defined by the ",(0,s.jsx)(n.code,{children:"CARDANO_NODE_SOCKET_PATH"})," environment variable used to launch the ",(0,s.jsx)(n.strong,{children:"Cardano node"}),")"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Install a recent version of ",(0,s.jsx)(n.a,{href:"https://github.com/IntersectMBO/cardano-node/releases/tag/8.9.1",children:(0,s.jsx)(n.code,{children:"cardano-cli"})})," (version 8.9.1+)"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Install a correctly configured Rust toolchain (latest stable version); you can follow the instructions provided ",(0,s.jsx)(n.a,{href:"https://www.rust-lang.org/learn/get-started",children:"here"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Install build tools ",(0,s.jsx)(n.code,{children:"build-essential"})," and ",(0,s.jsx)(n.code,{children:"m4"}),"; for example, on Ubuntu/Debian/Mint, run ",(0,s.jsx)(n.code,{children:"sudo apt install build-essential m4"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Install OpenSSL development libraries; for example, on Ubuntu/Debian/Mint, run ",(0,s.jsx)(n.code,{children:"apt install libssl-dev"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Install a recent version of ",(0,s.jsx)(n.code,{children:"jq"})," (version 1.6+) by running ",(0,s.jsx)(n.code,{children:"apt install jq"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["Only for the ",(0,s.jsx)(n.strong,{children:"production"})," deployment, install a recent version of ",(0,s.jsx)(n.a,{href:"http://www.squid-cache.org/",children:(0,s.jsx)(n.code,{children:"squid-cache"})})," (version 6.12+)."]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"set-up-the-mithril-signer-node",children:"Set up the Mithril signer node"}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["For ",(0,s.jsx)(n.strong,{children:"production"})," deployment, the ",(0,s.jsx)(n.strong,{children:"Mithril signer"})," setup is performed on the ",(0,s.jsx)(n.strong,{children:"Cardano block producer"})," machine"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["For ",(0,s.jsx)(n.strong,{children:"naive"})," deployment, the ",(0,s.jsx)(n.strong,{children:"Mithril signer"})," setup is performed on the ",(0,s.jsx)(n.strong,{children:"Cardano relay"})," machine."]}),"\n"]}),"\n"]})}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsxs)(n.p,{children:["Compare the version of your Cardano node with the minimum supported versions listed in the ",(0,s.jsx)(n.a,{href:"https://github.com/input-output-hk/mithril/blob/main/networks.json",children:(0,s.jsx)(n.code,{children:"networks.json"})})," file to verify its compatibility with the Mithril signer."]}),(0,s.jsx)(n.p,{children:"First, check the version of your Cardano node by running the following command:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cardano-node --version\n"})}),(0,s.jsxs)(n.p,{children:["Then, refer to the minimum supported versions listed in the ",(0,s.jsx)(n.a,{href:"https://github.com/input-output-hk/mithril/blob/main/networks.json",children:(0,s.jsx)(n.code,{children:"networks.json"})})," file."]}),(0,s.jsx)(n.p,{children:"You can also fetch the minimum supported version for your network using the command below:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'wget -q -O - https://raw.githubusercontent.com/input-output-hk/mithril/main/networks.json | jq -r \'."**YOUR_CARDANO_NETWORK**"."cardano-minimum-version"."mithril-signer"\'\n'})}),(0,s.jsxs)(n.p,{children:["Here is an example for ",(0,s.jsx)(n.code,{children:"preprod"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'wget -q -O - https://raw.githubusercontent.com/input-output-hk/mithril/main/networks.json | jq -r \'."preprod"."cardano-minimum-version"."mithril-signer"\'\n'})})]}),"\n",(0,s.jsx)(n.h3,{id:"building-your-own-executable",children:"Building your own executable"}),"\n",(0,s.jsx)(n.h4,{id:"download-the-source-file",children:"Download the source file"}),"\n",(0,s.jsx)(n.p,{children:"To download the source from GitHub (HTTPS), run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/input-output-hk/mithril.git\n"})}),"\n",(0,s.jsx)(n.p,{children:"Or (SSH):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"git clone git@github.com:input-output-hk/mithril.git\n"})}),"\n",(0,s.jsx)(n.h4,{id:"build-the-mithril-signer-binary",children:"Build the Mithril signer binary"}),"\n",(0,s.jsx)(n.p,{children:"First, switch to build a branch/tag:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# **YOUR_BUILD_BRANCH_OR_TAG** depends on the Mithril network you target,\n# please refer to the **Build from** column of the **Mithril networks** section\ngit checkout **YOUR_BUILD_BRANCH_OR_TAG**\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then, change the directory:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"cd mithril/mithril-signer\n"})}),"\n",(0,s.jsx)(n.p,{children:"Run tests (optional):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"make test\n"})}),"\n",(0,s.jsx)(n.p,{children:"Finally, build the executable:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"make build\n"})}),"\n",(0,s.jsx)(n.h3,{id:"download-the-pre-built-binary",children:"Download the pre-built binary"}),"\n",(0,s.jsx)(o.default,{node:"mithril-signer"}),"\n",(0,s.jsx)(n.h3,{id:"verifying-the-binary",children:"Verifying the binary"}),"\n",(0,s.jsx)(n.h4,{id:"verify-the-version-of-the-binary",children:"Verify the version of the binary"}),"\n",(0,s.jsx)(n.p,{children:"You can check that the Mithril signer binary is running the correct version by running:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"./mithril-signer -V\n"})}),"\n",(0,s.jsx)(n.p,{children:"You should see something like:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"mithril-signer 0.2.0\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u26a0\ufe0f"," Please verify that the displayed version matches the version described in the release/pre-release notes (refer to the ",(0,s.jsx)(n.strong,{children:"Build from"})," column in the ",(0,s.jsx)(n.strong,{children:"Mithril networks"})," section)."]}),"\n",(0,s.jsx)(n.h4,{id:"verify-the-build",children:"Verify the build"}),"\n",(0,s.jsx)(n.p,{children:"Check that the Mithril signer binary is working correctly by running the help function:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"./mithril-signer -h\n"})}),"\n",(0,s.jsx)(n.p,{children:"You should see:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"An implementation of a Mithril signer\n\nUsage: mithril-signer [OPTIONS]\n\nOptions:\n  -r, --run-mode <RUN_MODE>\n          Run Mode [env: RUN_MODE=] [default: dev]\n  -v, --verbose...\n          Verbosity level, add more v to increase\n  -c, --configuration-dir <CONFIGURATION_DIR>\n          Directory where the configuration file is located [default: ./config]\n      --disable-digests-cache\n          Disable immutables digests cache\n      --reset-digests-cache\n          If set the existing immutables digests cache will be reset\n  -h, --help\n          Print help information (use `--help` for more detail)\n  -V, --version\n          Print version information\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)(n.p,{children:"If you wish to delve deeper, you can access logs at various levels from the Mithril signer:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Add ",(0,s.jsx)(n.code,{children:"-v"})," for some logs (WARN)"]}),"\n",(0,s.jsxs)(n.li,{children:["Add ",(0,s.jsx)(n.code,{children:"-vv"})," for more logs (INFO)"]}),"\n",(0,s.jsxs)(n.li,{children:["Add ",(0,s.jsx)(n.code,{children:"-vvv"})," for even more logs (DEBUG)"]}),"\n",(0,s.jsxs)(n.li,{children:["Add ",(0,s.jsx)(n.code,{children:"-vvvv"})," for all logs (TRACE)."]}),"\n"]})]}),"\n",(0,s.jsx)(n.h3,{id:"installing-the-service",children:"Installing the service"}),"\n",(0,s.jsx)(n.h4,{id:"move-the-executable",children:"Move the executable"}),"\n",(0,s.jsx)(n.p,{children:"To move the executable to /opt/mithril, run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo mkdir -p /opt/mithril\nsudo mv mithril-signer /opt/mithril\n"})}),"\n",(0,s.jsx)(n.h4,{id:"set-up-the-service",children:"Set up the service"}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"User=cardano"}),":\nReplace this value with the correct user. Here, we assume that the user running the ",(0,s.jsx)(n.strong,{children:"Cardano node"})," is ",(0,s.jsx)(n.code,{children:"cardano"}),". The ",(0,s.jsx)(n.strong,{children:"Mithril signer"})," must imperatively run with the same user."]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["In the ",(0,s.jsx)(n.code,{children:"/opt/mithril/mithril-signer.env"})," env file:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"KES_SECRET_KEY_PATH=/cardano/keys/kes.skey"}),": replace ",(0,s.jsx)(n.code,{children:"/cardano/keys/kes.skey"})," with the path to your Cardano ",(0,s.jsx)(n.code,{children:"KES secret key"})," file"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"OPERATIONAL_CERTIFICATE_PATH=/cardano/cert/opcert.cert"}),": replace ",(0,s.jsx)(n.code,{children:"/cardano/cert/opcert.cert"})," with the path to your Cardano ",(0,s.jsx)(n.code,{children:"operational certificate"})," file"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"DB_DIRECTORY=/cardano/db"}),": replace ",(0,s.jsx)(n.code,{children:"/cardano/db"})," with the path to the database folder of the ",(0,s.jsx)(n.strong,{children:"Cardano node"})," (the one in ",(0,s.jsx)(n.code,{children:"--database-path"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"CARDANO_NODE_SOCKET_PATH=/cardano/ipc/node.socket"}),": replace with the path to the IPC file (",(0,s.jsx)(n.code,{children:"CARDANO_NODE_SOCKET_PATH"})," env var)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"CARDANO_CLI_PATH=/app/bin/cardano-cli"}),": replace with the path to the ",(0,s.jsx)(n.code,{children:"cardano-cli"})," executable"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"DATA_STORES_DIRECTORY=/opt/mithril/stores"}),": replace with the path to a folder where the ",(0,s.jsx)(n.strong,{children:"Mithril signer"})," will store its data (eg, ",(0,s.jsx)(n.code,{children:"/opt/mithril/stores"}),")"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"STORE_RETENTION_LIMIT"}),": if set, this will limit the number of records in some internal stores (5 is a good fit)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"ERA_READER_ADAPTER_TYPE=cardano-chain"}),": replace ",(0,s.jsx)(n.code,{children:"cardano-chain"})," with the era reader adapter type used in your Mithril network"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:'ERA_READER_ADAPTER_PARAMS={"address": "...", "verification_key": "..."}'}),": replace ",(0,s.jsx)(n.code,{children:'{"address": "...", "verification_key": "..."}'})," with the era reader parameters that you need to compute by running the command ",(0,s.jsx)(n.code,{children:'jq -nc --arg address $(wget -q -O - **YOUR_ERA_READER_ADDRESS**) --arg verification_key $(wget -q -O - **YOUR_ERA_READER_VERIFICATION_KEY**) \'{"address": $address, "verification_key": $verification_key}\''})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"RELAY_ENDPOINT=http://192.168.1.50:3132"})," ",(0,s.jsx)(n.strong,{children:"(optional)"}),": this is the endpoint of the ",(0,s.jsx)(n.strong,{children:"Mithril relay"}),", which is required for ",(0,s.jsx)(n.strong,{children:"production"})," deployment only. For ",(0,s.jsx)(n.strong,{children:"naive"})," deployment, do not set this variable in your environment file."]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an ",(0,s.jsx)(n.strong,{children:"example"})," set of values for ",(0,s.jsx)(n.strong,{children:"release-preprod"})," that will be used in this guide in the ",(0,s.jsx)(n.strong,{children:"tip"})," boxes to illustrate some commands:"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_KES_SECRET_KEY_PATH"}),": ",(0,s.jsx)(n.code,{children:"/cardano/keys/kes.skey"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_OPERATIONAL_CERTIFICATE_PATH"}),": ",(0,s.jsx)(n.code,{children:"/cardano/keys/node.cert"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_CARDANO_NETWORK"}),": ",(0,s.jsx)(n.code,{children:"preprod"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_AGGREGATOR_ENDPOINT"}),": ",(0,s.jsx)(n.code,{children:"https://aggregator.release-preprod.api.mithril.network/aggregator"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_ERA_READER_ADAPTER_TYPE"}),": ",(0,s.jsx)(n.code,{children:"cardano-chain"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_ERA_READER_ADAPTER_PARAMS"}),": ",(0,s.jsx)(n.code,{children:'{"address": "addr_test1qpkyv2ws0deszm67t840sdnruqgr492n80g3y96xw3p2ksk6suj5musy6w8lsg3yjd09cnpgctc2qh386rtxphxt248qr0npnx", "verification_key": "5b35352c3232382c3134342c38372c3133382c3133362c34382c382c31342c3138372c38352c3134382c39372c3233322c3235352c3232392c33382c3234342c3234372c3230342c3139382c31332c33312c3232322c32352c3136342c35322c3130322c39312c3132302c3230382c3134375d"}'})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_RELAY_ENDPOINT"}),": ",(0,s.jsx)(n.code,{children:"192.168.1.50"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_RELAY_LISTENING_PORT"}),": ",(0,s.jsx)(n.code,{children:"3132"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_BLOCK_PRODUCER_INTERNAL_IP"}),": ",(0,s.jsx)(n.code,{children:"192.168.1.75"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_SIGNER_LOGS_PATH"}),": ",(0,s.jsx)(n.code,{children:"/var/log/syslog"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_PARTY_ID"}),": ",(0,s.jsx)(n.code,{children:"pool1hp72sauk0g0yqm4dzllz0pz6j93gewhllkzphn4hykkfmne43y"})]}),"\n"]})]}),"\n",(0,s.jsx)(n.p,{children:"First, create an environment file that the service will use:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For ",(0,s.jsx)(n.strong,{children:"production"})," deployment:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat > /opt/mithril/mithril-signer.env << EOF\nKES_SECRET_KEY_PATH=**YOUR_KES_SECRET_KEY_PATH**\nOPERATIONAL_CERTIFICATE_PATH=**YOUR_OPERATIONAL_CERTIFICATE_PATH**\nNETWORK=**YOUR_CARDANO_NETWORK**\nAGGREGATOR_ENDPOINT=**YOUR_AGGREGATOR_ENDPOINT**\nRUN_INTERVAL=60000\nDB_DIRECTORY=/cardano/db\nCARDANO_NODE_SOCKET_PATH=/cardano/ipc/node.socket\nCARDANO_CLI_PATH=/app/bin/cardano-cli\nDATA_STORES_DIRECTORY=/opt/mithril/stores\nSTORE_RETENTION_LIMIT=5\nERA_READER_ADAPTER_TYPE=**YOUR_ERA_READER_ADAPTER_TYPE**\nERA_READER_ADAPTER_PARAMS=**YOUR_ERA_READER_ADAPTER_PARAMS**\nRELAY_ENDPOINT=**YOUR_RELAY_ENDPOINT**\nEOF'\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"release-preprod"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'sudo bash -c \'cat > /opt/mithril/mithril-signer.env << EOF\nKES_SECRET_KEY_PATH=/cardano/keys/kes.skey\nOPERATIONAL_CERTIFICATE_PATH=/cardano/keys/node.cert\nNETWORK=preprod\nAGGREGATOR_ENDPOINT=https://aggregator.release-preprod.api.mithril.network/aggregator\nRUN_INTERVAL=60000\nDB_DIRECTORY=/cardano/db\nCARDANO_NODE_SOCKET_PATH=/cardano/ipc/node.socket\nCARDANO_CLI_PATH=/app/bin/cardano-cli\nDATA_STORES_DIRECTORY=/opt/mithril/stores\nSTORE_RETENTION_LIMIT=5\nERA_READER_ADAPTER_TYPE=cardano-chain\nERA_READER_ADAPTER_PARAMS={"address": "addr_test1qpkyv2ws0deszm67t840sdnruqgr492n80g3y96xw3p2ksk6suj5musy6w8lsg3yjd09cnpgctc2qh386rtxphxt248qr0npnx", "verification_key": "5b35352c3232382c3134342c38372c3133382c3133362c34382c382c31342c3138372c38352c3134382c39372c3233322c3235352c3232392c33382c3234342c3234372c3230342c3139382c31332c33312c3232322c32352c3136342c35322c3130322c39312c3132302c3230382c3134375d"}\nRELAY_ENDPOINT=http://192.168.1.50:3132\nEOF\'\n'})})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For ",(0,s.jsx)(n.strong,{children:"naive"})," deployment:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat > /opt/mithril/mithril-signer.env << EOF\nKES_SECRET_KEY_PATH=**YOUR_KES_SECRET_KEY_PATH**\nOPERATIONAL_CERTIFICATE_PATH=**YOUR_OPERATIONAL_CERTIFICATE_PATH**\nNETWORK=**YOUR_CARDANO_NETWORK**\nAGGREGATOR_ENDPOINT=**YOUR_AGGREGATOR_ENDPOINT**\nRUN_INTERVAL=60000\nDB_DIRECTORY=/cardano/db\nCARDANO_NODE_SOCKET_PATH=/cardano/ipc/node.socket\nCARDANO_CLI_PATH=/app/bin/cardano-cli\nDATA_STORES_DIRECTORY=/opt/mithril/stores\nSTORE_RETENTION_LIMIT=5\nERA_READER_ADAPTER_TYPE=**YOUR_ERA_READER_ADAPTER_TYPE**\nERA_READER_ADAPTER_PARAMS=**YOUR_ERA_READER_ADAPTER_PARAMS**\nEOF'\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"release-preprod"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'sudo bash -c \'cat > /opt/mithril/mithril-signer.env << EOF\nKES_SECRET_KEY_PATH=/cardano/keys/kes.skey\nOPERATIONAL_CERTIFICATE_PATH=/cardano/keys/node.cert\nNETWORK=preprod\nAGGREGATOR_ENDPOINT=https://aggregator.release-preprod.api.mithril.network/aggregator\nRUN_INTERVAL=60000\nDB_DIRECTORY=/cardano/db\nCARDANO_NODE_SOCKET_PATH=/cardano/ipc/node.socket\nCARDANO_CLI_PATH=/app/bin/cardano-cli\nDATA_STORES_DIRECTORY=/opt/mithril/stores\nSTORE_RETENTION_LIMIT=5\nERA_READER_ADAPTER_TYPE=cardano-chain\nERA_READER_ADAPTER_PARAMS={"address": "addr_test1qpkyv2ws0deszm67t840sdnruqgr492n80g3y96xw3p2ksk6suj5musy6w8lsg3yjd09cnpgctc2qh386rtxphxt248qr0npnx", "verification_key": "5b35352c3232382c3134342c38372c3133382c3133362c34382c382c31342c3138372c38352c3134382c39372c3233322c3235352c3232392c33382c3234342c3234372c3230342c3139382c31332c33312c3232322c32352c3136342c35322c3130322c39312c3132302c3230382c3134375d"}\nEOF\'\n'})})]}),"\n",(0,s.jsxs)(n.p,{children:["Then, create a ",(0,s.jsx)(n.code,{children:"/etc/systemd/system/mithril-signer.service"})," description file for the service:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat > /etc/systemd/system/mithril-signer.service << EOF\n[Unit]\nDescription=Mithril signer service\nStartLimitIntervalSec=0\n\n[Service]\nType=simple\nRestart=always\nRestartSec=60\nUser=cardano\nEnvironmentFile=/opt/mithril/mithril-signer.env\nExecStart=/opt/mithril/mithril-signer -vvv\n\n[Install]\nWantedBy=multi-user.target\nEOF'\n"})}),"\n",(0,s.jsx)(n.p,{children:"Reload the service configuration (optional):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then, start the service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl start mithril-signer\n"})}),"\n",(0,s.jsx)(n.p,{children:"Register the service to start on boot:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable mithril-signer\n"})}),"\n",(0,s.jsx)(n.p,{children:"Monitor the status of the service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"systemctl status mithril-signer.service\n"})}),"\n",(0,s.jsx)(n.p,{children:"Finally, monitor the logs of the service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tail -f /var/log/syslog | grep mithril-signer\n"})}),"\n",(0,s.jsx)(n.h3,{id:"activate-a-prometheus-endpoint",children:"Activate a Prometheus endpoint"}),"\n",(0,s.jsx)(n.p,{children:"The Mithril signer node can expose basic metrics on a Prometheus endpoint, which is not activated by default."}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:"Metrics"}),(0,s.jsx)(n.th,{children:"Description"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"mithril_signer_signer_registration_success_since_startup"})}),(0,s.jsx)(n.td,{children:"Number of successful signer registrations since startup on a Mithril signer node"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"mithril_signer_signer_registration_total_since_startup"})}),(0,s.jsx)(n.td,{children:"Number of signer registrations since startup on a Mithril signer node"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"mithril_signer_signer_registration_success_last_epoch"})}),(0,s.jsx)(n.td,{children:"Latest epoch at which signer successfully registered on a Mithril signer node"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"mithril_signer_signature_registration_success_since_startup"})}),(0,s.jsx)(n.td,{children:"Number of successful signature registrations since startup on a Mithril signer node"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"mithril_signer_signature_registration_total_since_startup"})}),(0,s.jsx)(n.td,{children:"Number of signature registrations since startup on a Mithril signer node"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"mithril_signer_signature_registration_success_last_epoch"})}),(0,s.jsx)(n.td,{children:"Latest epoch at which signature successfully registered on a Mithril signer node"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"mithril_signer_runtime_cycle_success_since_startup"})}),(0,s.jsx)(n.td,{children:"Number of successful runtime cycles since startup on a Mithril signer node"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.strong,{children:"mithril_signer_runtime_cycle_total_since_startup"})}),(0,s.jsx)(n.td,{children:"Number of runtime cycles since startup on a Mithril signer node"})]})]})]}),"\n",(0,s.jsxs)(n.p,{children:["To expose metrics on the endpoint, append the following environment variable to your environment file. In that case, the metrics server will listen on the ",(0,s.jsx)(n.code,{children:"9090"})," port:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-signer.env << EOF\nENABLE_METRICS_SERVER=true\nEOF`\n"})}),"\n",(0,s.jsx)(n.p,{children:"You can also specify a custom listen IP address and port for the metrics server:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-signer.env << EOF\nENABLE_METRICS_SERVER=true\nMETRICS_SERVER_IP=**YOUR_METRICS_SERVER_IP**\nMETRICS_SERVER_PORT=**YOUR_METRICS_SERVER_PORT**\nEOF`\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)(n.p,{children:"Here is an example that reproduces the default configuration for the Prometheus server:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-signer.env << EOF\nENABLE_METRICS_SERVER=true\nMETRICS_SERVER_IP=0.0.0.0\nMETRICS_SERVER_PORT=9090\nEOF`\n"})})]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["When activated, the metrics endpoint will be accessible at the ",(0,s.jsx)(n.code,{children:"http://**YOUR_METRICS_SERVER_IP**:**YOUR_METRICS_SERVER_PORT**/metrics"})," location, which translates to ",(0,s.jsx)(n.a,{href:"http://0.0.0.0:9090/metrics",children:(0,s.jsx)(n.code,{children:"http://0.0.0.0:9090/metrics"})})," with the default configuration."]})}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["See this ",(0,s.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/20776-mithril-signer/",children:"Grafana template"}),", which helps to easily set up a dashboard for this Prometheus endpoint (ID 20776)."]})}),"\n",(0,s.jsx)(n.h3,{id:"rotating-the-kes-keys",children:"Rotating the KES keys"}),"\n",(0,s.jsx)(n.admonition,{type:"danger",children:(0,s.jsx)(n.p,{children:"When the KES keys expire, the Mithril signer cannot register with the Mithril protocol."})}),"\n",(0,s.jsx)(n.p,{children:"After rotating the KES keys on your Cardano block producer, we recommend following this upgrade procedure for your Mithril signer node:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Update the ",(0,s.jsx)(n.code,{children:"KES_SECRET_KEY_PATH"})," entry of your environment file to reflect the location of the ",(0,s.jsx)(n.strong,{children:"new KES secret key file"})]}),"\n",(0,s.jsxs)(n.li,{children:["Update the ",(0,s.jsx)(n.code,{children:"OPERATIONAL_CERTIFICATE_PATH"})," entry of your environment file to reflect the location of the ",(0,s.jsx)(n.strong,{children:"new operational certificate file"})]}),"\n",(0,s.jsx)(n.li,{children:"Restart your Mithril signer service with the following command:"}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl restart mithril-signer\n"})}),"\n",(0,s.jsxs)(n.ol,{start:"4",children:["\n",(0,s.jsxs)(n.li,{children:["Check the logs of your signer node and make sure that it has successfully registered after restarting (the following log should be displayed: ",(0,s.jsx)(n.code,{children:"STATE MACHINE: new cycle: Registered"}),")."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"set-up-the-mithril-relay-node",children:"Set up the Mithril relay node"}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["For ",(0,s.jsx)(n.strong,{children:"production"})," deployment, the setup of the ",(0,s.jsx)(n.strong,{children:"Mithril relay"})," is performed on the ",(0,s.jsx)(n.strong,{children:"Cardano relay"})," machine"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["For ",(0,s.jsx)(n.strong,{children:"naive"})," deployment, this step is not necessary."]}),"\n"]}),"\n"]})}),"\n",(0,s.jsx)(n.h3,{id:"building-squid-from-source",children:"Building Squid from source"}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["If you have already installed ",(0,s.jsx)(n.code,{children:"Squid"})," via the ",(0,s.jsx)(n.code,{children:"apt"})," package manager, we recommend that you delete it before manually building it from source by running the following commands:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"sudo systemctl stop squid"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"sudo apt remove squid"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"sudo apt autoremove"})}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["The FAQ for compiling ",(0,s.jsx)(n.code,{children:"Squid"})," is available ",(0,s.jsx)(n.a,{href:"https://wiki.squid-cache.org/SquidFaq/CompilingSquid",children:"here"})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["You will need a C++ compiler that can be installed with the ",(0,s.jsx)(n.code,{children:"sudo apt install build-essential"})," command."]}),"\n"]}),"\n"]})}),"\n",(0,s.jsxs)(n.p,{children:["On the ",(0,s.jsx)(n.a,{href:"https://www.squid-cache.org/Versions/",children:"Squid page with released versions"}),", identify the latest stable released version (currently ",(0,s.jsx)(n.code,{children:"6.12"}),") and download it:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"wget https://www.squid-cache.org/Versions/v6/squid-6.12.tar.gz\n"})}),"\n",(0,s.jsx)(n.p,{children:"Uncompress the downloaded archive and change the directory:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tar xzf squid-6.12.tar.gz\ncd squid-6.12\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then, configure the compilation:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"./configure \\\n    --prefix=/opt/squid \\\n    --localstatedir=/opt/squid/var \\\n    --libexecdir=/opt/squid/lib/squid \\\n    --datadir=/opt/squid/share/squid \\\n    --sysconfdir=/etc/squid \\\n    --with-default-user=squid \\\n    --with-logdir=/opt/squid/var/log/squid \\\n    --with-pidfile=/opt/squid/var/run/squid.pid\n"})}),"\n",(0,s.jsx)(n.p,{children:"Compile the sources:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"make\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Install ",(0,s.jsx)(n.code,{children:"squid"})," binary:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo make install\n"})}),"\n",(0,s.jsx)(n.p,{children:"Optionally, verify that the version is correct:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"/opt/squid/sbin/squid -v\n"})}),"\n",(0,s.jsx)(n.p,{children:"You should see a result like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"Squid Cache: Version 6.12\nService Name: squid\nconfigure options:  '--prefix=/opt/squid' '--localstatedir=/opt/squid/var' '--libexecdir=/opt/squid/lib/squid' '--datadir=/opt/squid/share/squid' '--sysconfdir=/etc/squid' '--with-default-user=squid' '--with-logdir=/opt/squid/var/log/squid' '--with-pidfile=/opt/squid/var/run/squid.pid'\n"})}),"\n",(0,s.jsx)(n.h3,{id:"configuring-the-squid-proxy",children:"Configuring the Squid proxy"}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.strong,{children:"Mithril relay"})," node serves as a forward proxy, relaying traffic between the ",(0,s.jsx)(n.strong,{children:"Mithril signer"})," and the ",(0,s.jsx)(n.strong,{children:"Mithril aggregator"}),". When appropriately configured, it facilitates the security of the ",(0,s.jsx)(n.strong,{children:"block-producing"})," node. You can use ",(0,s.jsx)(n.code,{children:"squid"})," to operate this forward proxy, and this section presents a recommended configuration."]})}),"\n",(0,s.jsx)(n.p,{children:"Make a copy of the original configuration:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo cp /etc/squid/squid.conf /etc/squid/squid.conf.bak\n"})}),"\n",(0,s.jsx)(n.p,{children:"Prepare the forward proxy configuration file:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat > /etc/squid/squid.conf << EOF\n# Listening port (port 3132 is recommended)\nhttp_port **YOUR_RELAY_LISTENING_PORT**\n\n# ACL for the internal IP of your block producer node\nacl block_producer_internal_ip src **YOUR_BLOCK_PRODUCER_INTERNAL_IP**\n\n# ACL for aggregator endpoint\nacl aggregator_domain dstdomain .mithril.network\n\n# ACL for SSL port only\nacl SSL_port port 443\n\n# Allowed traffic\nhttp_access allow block_producer_internal_ip aggregator_domain SSL_port\n\n# Do not disclose block producer internal IP\nforwarded_for delete\n\n# Turn off via header\nvia off\n\n# Deny request for original source of a request\nfollow_x_forwarded_for deny all\n\n# Anonymize request headers\nrequest_header_access Authorization allow all\nrequest_header_access Proxy-Authorization allow all\nrequest_header_access Cache-Control allow all\nrequest_header_access Content-Length allow all\nrequest_header_access Content-Type allow all\nrequest_header_access Date allow all\nrequest_header_access Host allow all\nrequest_header_access If-Modified-Since allow all\nrequest_header_access Pragma allow all\nrequest_header_access Accept allow all\nrequest_header_access Accept-Charset allow all\nrequest_header_access Accept-Encoding allow all\nrequest_header_access Accept-Language allow all\nrequest_header_access Connection allow all\nrequest_header_access All deny all\n\n# Disable cache\ncache deny all\n\n# Deny everything else\nhttp_access deny all\n\nEOF'\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"release-preprod"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat > /etc/squid/squid.conf << EOF\n# Listening port (port 3132 is recommended)\nhttp_port 3132\n\n# ACL for the internal IP of your block producer node\nacl block_producer_internal_ip src 192.168.1.75\n\n# ACL for aggregator endpoint\nacl aggregator_domain dstdomain .mithril.network\n\n# ACL for SSL port only\nacl SSL_port port 443\n\n# Allowed traffic\nhttp_access allow block_producer_internal_ip aggregator_domain SSL_port\n\n# Do not disclose block producer internal IP\nforwarded_for delete\n\n# Turn off via header\nvia off\n\n# Deny request for original source of a request\nfollow_x_forwarded_for deny all\n\n# Anonymize request headers\nrequest_header_access Authorization allow all\nrequest_header_access Proxy-Authorization allow all\nrequest_header_access Cache-Control allow all\nrequest_header_access Content-Length allow all\nrequest_header_access Content-Type allow all\nrequest_header_access Date allow all\nrequest_header_access Host allow all\nrequest_header_access If-Modified-Since allow all\nrequest_header_access Pragma allow all\nrequest_header_access Accept allow all\nrequest_header_access Accept-Charset allow all\nrequest_header_access Accept-Encoding allow all\nrequest_header_access Accept-Language allow all\nrequest_header_access Connection allow all\nrequest_header_access All deny all\n\n# Disable cache\ncache deny all\n\n# Deny everything else\nhttp_access deny all\n\nEOF'\n"})})]}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)(n.p,{children:"If you are using the same Cardano relay for multiple Cardano block producers, you will need to add a new line per block producer to authorize its internal IP:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"# ACL for the internal IP of your block producer node\nacl block_producer_internal_ip src **YOUR_BLOCK_PRODUCER_INTERNAL_IP_1**\nacl block_producer_internal_ip src **YOUR_BLOCK_PRODUCER_INTERNAL_IP_2**\nacl block_producer_internal_ip src **YOUR_BLOCK_PRODUCER_INTERNAL_IP_3**\n"})})]}),"\n",(0,s.jsx)(n.p,{children:"With this configuration, the proxy will:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Accept incoming traffic originating from the internal IP of the block-producing machine"}),"\n",(0,s.jsx)(n.li,{children:"Accept incoming traffic directed to the listening port of the proxy"}),"\n",(0,s.jsxs)(n.li,{children:["Accept incoming HTTPS traffic proxied to ",(0,s.jsx)(n.code,{children:"mithril.network"})," domain hosts"]}),"\n",(0,s.jsx)(n.li,{children:"Anonymize the traffic completely and avoid disclosing any information about the block-producing machine"}),"\n",(0,s.jsx)(n.li,{children:"Deny all other traffic."}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"info"}),"\n",(0,s.jsx)(n.h3,{id:"installing-the-service-1",children:"Installing the service"}),"\n",(0,s.jsx)(n.p,{children:"Create (or re-use) an unprivileged system user on the machine:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo adduser --system --no-create-home --group squid\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Change ownership of ",(0,s.jsx)(n.code,{children:"/opt/squid/var"})," directory:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo chown squid -R /opt/squid/var/\nsudo chgrp squid -R /opt/squid/var/\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Create a ",(0,s.jsx)(n.code,{children:"/etc/systemd/system/squid.service"})," description file for the service:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat > /etc/systemd/system/squid.service << EOF\n[Unit]\nDescription=Squid service\nStartLimitIntervalSec=0\n\n[Service]\nType=simple\nRestart=always\nRestartSec=60\nUser=squid\nGroup=squid\nExecStart=/opt/squid/sbin/squid -f /etc/squid/squid.conf -d5\nPIDFile=/opt/squid/var/run/squid.pid\n\n[Install]\nWantedBy=multi-user.target\nEOF'\n"})}),"\n",(0,s.jsx)(n.p,{children:"Reload the service configuration (optional):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then, start the service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl start squid\n"})}),"\n",(0,s.jsx)(n.p,{children:"Register the service to start on boot:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable squid\n"})}),"\n",(0,s.jsx)(n.p,{children:"Monitor the status of the service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"systemctl status squid\n"})}),"\n",(0,s.jsx)(n.p,{children:"Finally, monitor the logs of the service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tail -f /var/log/syslog | grep squid\n"})}),"\n",(0,s.jsx)(n.p,{children:"And monitor squid access logs:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo tail -f /opt/squid/var/log/squid/access.log\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["If your ",(0,s.jsx)(n.strong,{children:"Squid service"})," does not start properly and you have the error message ",(0,s.jsx)(n.code,{children:"FATAL: /dev/null (13) Permission denied"})," in the logs of the service, it means that some permissions need to be fixed following the creation of the new ",(0,s.jsx)(n.code,{children:"squid"})," user by running the following commands:"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"sudo chmod 666 /dev/null"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"sudo systemctl restart squid"})}),"\n"]})]}),"\n",(0,s.jsx)(n.h3,{id:"firewall-configuration",children:"Firewall configuration"}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["We assume that the ",(0,s.jsx)(n.strong,{children:"Cardano relay"})," machine is protected by a firewall. Therefore, it is necessary to allow the proxied traffic originating from the ",(0,s.jsx)(n.strong,{children:"Cardano block producer"})," through this firewall."]})}),"\n",(0,s.jsx)(n.h4,{id:"about-the-cardano-relay-machine",children:"About the Cardano relay machine"}),"\n",(0,s.jsxs)(n.p,{children:["You need to allow incoming traffic on the listening port of the ",(0,s.jsx)(n.strong,{children:"Mithril relay"})," on the ",(0,s.jsx)(n.strong,{children:"Cardano relay"})," machine, originating from the ",(0,s.jsx)(n.strong,{children:"Cardano block producer"})," machine."]}),"\n",(0,s.jsxs)(n.p,{children:["Assuming you are using ",(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Uncomplicated_Firewall",children:(0,s.jsx)(n.code,{children:"Uncomplicated Firewall"})})," (",(0,s.jsx)(n.code,{children:"0.36+"}),"), the command to open that traffic is:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo ufw allow from **YOUR_BLOCK_PRODUCER_INTERNAL_IP** to any port **YOUR_RELAY_LISTENING_PORT** proto tcp\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"release-preprod"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo ufw allow from 192.168.1.75 to any port 3132 proto tcp\n"})})]}),"\n",(0,s.jsxs)(n.p,{children:["Assuming you are using ",(0,s.jsx)(n.a,{href:"https://en.wikipedia.org/wiki/Iptables",children:(0,s.jsx)(n.code,{children:"Iptables"})})," (",(0,s.jsx)(n.code,{children:"1.8.7+"}),"), the command to open that traffic is:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo iptables -A INPUT -s **YOUR_BLOCK_PRODUCER_INTERNAL_IP** -p tcp --dport **YOUR_RELAY_LISTENING_PORT** -j ACCEPT\nsudo iptables -L -v\nsudo service netfilter-persistent save\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"release-preprod"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo iptables -A INPUT -s 192.168.1.75 -p tcp --dport 3132 -j ACCEPT\nsudo iptables -L -v\nsudo service netfilter-persistent save\n"})})]}),"\n",(0,s.jsx)(n.h2,{id:"set-up-the-dmq-node-unstable",children:"Set up the DMQ node (unstable)"}),"\n",(0,s.jsxs)(n.admonition,{type:"danger",children:[(0,s.jsxs)(n.p,{children:["The DMQ node setup is currently ",(0,s.jsx)(n.strong,{children:"unstable"})," and not suitable for production use."]}),(0,s.jsx)(n.p,{children:"During the stabilization and ramp-up phase of the DMQ network:"}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Signatures are still sent to the central aggregator (using the DMQ node is harmless)"}),"\n",(0,s.jsx)(n.li,{children:"This section is subject to frequent changes."}),"\n"]})]}),"\n",(0,s.jsxs)(n.p,{children:["The DMQ node supports the implementation of a ",(0,s.jsx)(n.strong,{children:"Decentralized Message Queue"})," (DMQ) for Mithril. The DMQ protocol allows Mithril signers to exchange signatures in a decentralized manner, enhancing the robustness and scalability of the Mithril networks. Once stabilized and deployed on a majority of SPOs on a Mithril network, the DMQ protocol will allow multiple aggregators to operate simultaneously, improving the overall availability of the Mithril protocol. The DMQ protocol is fully described in the ",(0,s.jsx)(n.a,{href:"https://cips.cardano.org/cip/CIP-0137",children:"CIP-0137"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"The DMQ node follows the same deployment model as the Mithril signer node and the Cardano node:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For ",(0,s.jsx)(n.strong,{children:"production"})," deployment, the ",(0,s.jsx)(n.strong,{children:"DMQ node"})," setup is performed on the ",(0,s.jsx)(n.strong,{children:"Cardano block producer"})," machine and on the ",(0,s.jsx)(n.strong,{children:"Cardano relay"})," machine"]}),"\n",(0,s.jsxs)(n.li,{children:["For ",(0,s.jsx)(n.strong,{children:"naive"})," deployment, the ",(0,s.jsx)(n.strong,{children:"DMQ node"})," setup is performed on the ",(0,s.jsx)(n.strong,{children:"Cardano relay"})," machine only (for tests only)."]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["If you choose the ",(0,s.jsx)(n.strong,{children:"production"})," deployment, you will need to install and configure the DMQ node on both the ",(0,s.jsx)(n.strong,{children:"Cardano block producer"})," machine and the ",(0,s.jsx)(n.strong,{children:"Cardano relay"})," machine, following the same steps."]}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Here is the needed information to set up a DMQ node:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**YOUR_DMQ_NODE_SOCKET_PATH**"}),": replace with the path to the IPC file of the DMQ node"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**YOUR_CARDANO_NODE_SOCKET_PATH**"}),": replace with the path to the IPC file of the Cardano node"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**YOUR_CARDANO_NETWORK_MAGIC**"}),": replace with the network magic number of your Cardano network"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**YOUR_DMQ_NODE_RELAY_INTERNAL_ADDRESS**"}),": replace with the ",(0,s.jsx)(n.strong,{children:"internal"})," IP address of your DMQ node on the relay machine"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**YOUR_DMQ_NODE_RELAY_PUBLIC_ADDRESS**"}),": replace with the ",(0,s.jsx)(n.strong,{children:"public"})," IP address of your DMQ node on the relay machine"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**YOUR_DMQ_NODE_RELAY_PORT**"}),": replace with the listening port of your DMQ node on the relay machine"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**YOUR_DMQ_NODE_BLOCK_PRODUCER_INTERNAL_ADDRESS**"}),": replace with the ",(0,s.jsx)(n.strong,{children:"internal"})," IP address of your DMQ node on the block producer machine (this is sensitive information that must not be shared publicly)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**YOUR_DMQ_NODE_BLOCK_PRODUCER_PORT**"}),": replace with the listening port of your DMQ node on the block producer machine"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**YOUR_DMQ_BOOTSTRAP_PEER_ADDRESS**"}),": replace with the IP address of your DMQ bootstrap peer (the address can be found in the ",(0,s.jsx)(n.a,{href:"/doc/next/manual/getting-started/network-configurations",children:"Mithril networks"})," table)"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"**YOUR_DMQ_BOOTSTRAP_PEER_PORT**"}),": replace with the listening port of your DMQ bootstrap peer (the value can be found in the ",(0,s.jsx)(n.a,{href:"/doc/next/manual/getting-started/network-configurations",children:"Mithril networks"})," table)."]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an ",(0,s.jsx)(n.strong,{children:"example"})," set of values for ",(0,s.jsx)(n.strong,{children:"pre-release-preview"})," that will be used in this guide in the ",(0,s.jsx)(n.strong,{children:"tip"})," boxes to illustrate some commands:"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_DMQ_NODE_SOCKET_PATH"}),": ",(0,s.jsx)(n.code,{children:"/dmq/ipc/node.socket"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_CARDANO_NODE_SOCKET_PATH"}),": ",(0,s.jsx)(n.code,{children:"/cardano/ipc/node.socket"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_CARDANO_NETWORK_MAGIC"}),": ",(0,s.jsx)(n.code,{children:"2"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_DMQ_NODE_RELAY_INTERNAL_ADDRESS"}),": ",(0,s.jsx)(n.code,{children:"192.168.1.30"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_DMQ_NODE_RELAY_PUBLIC_ADDRESS"}),": ",(0,s.jsx)(n.code,{children:"34.14.65.160"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_DMQ_NODE_RELAY_PORT"}),": ",(0,s.jsx)(n.code,{children:"6161"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_DMQ_NODE_BLOCK_PRODUCER_INTERNAL_ADDRESS"}),": ",(0,s.jsx)(n.code,{children:"192.168.1.60"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_DMQ_NODE_BLOCK_PRODUCER_PORT"}),": ",(0,s.jsx)(n.code,{children:"6161"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_DMQ_BOOTSTRAP_PEER_ADDRESS"}),": ",(0,s.jsx)(n.code,{children:"34.76.22.193"})]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"YOUR_DMQ_BOOTSTRAP_PEER_PORT"}),": ",(0,s.jsx)(n.code,{children:"6161"})]}),"\n"]})]}),"\n",(0,s.jsx)(n.h3,{id:"download-the-pre-built-binary-1",children:"Download the pre-built binary"}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["As we are still in a testing stage, we only support the ",(0,s.jsx)(n.code,{children:"pre-release-preview"})," network."]}),(0,s.jsxs)(n.p,{children:["You can use these parameters for the ",(0,s.jsx)(n.strong,{children:"pre-release-preview"})," network:"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.strong,{children:"DMQ_RELEASE_URL"}),": ",(0,s.jsx)(n.code,{children:"https://github.com/IntersectMBO/dmq-node/releases/download/0.2.0.0-pre-7/dmq-node-linux.tar.gz"})]}),"\n"]}),(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"These URLs may change in the future; please refer to this page for the latest released version of the DMQ node binary."})})]}),"\n",(0,s.jsx)(n.p,{children:"To download the latest released version of the DMQ node binary, run the following command:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"curl --fail -sL -o dmq-node.tar.gz **DMQ_RELEASE_URL**\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then, extract the archive:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tar -xzf dmq-node.tar.gz --strip-components=2 result/bin\n"})}),"\n",(0,s.jsx)(n.p,{children:"And test that the binary works:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"./dmq-node --version\n"})}),"\n",(0,s.jsx)(n.p,{children:"You should see something like:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"dmq-node version: 0.2.0.0\n"})}),"\n",(0,s.jsx)(n.h3,{id:"installing-the-service-2",children:"Installing the service"}),"\n",(0,s.jsx)(n.h4,{id:"move-the-executable-1",children:"Move the executable"}),"\n",(0,s.jsx)(n.p,{children:"To move the executable to /opt/dmq, run:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo mkdir -p /opt/dmq\nsudo mv dmq-node /opt/dmq\n"})}),"\n",(0,s.jsx)(n.h4,{id:"prepare-the-configuration-file-of-the-dmq-node",children:"Prepare the configuration file of the DMQ node"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For a ",(0,s.jsx)(n.strong,{children:"DMQ node on the relay machine"}),", create a ",(0,s.jsx)(n.code,{children:"/opt/dmq/config-relay.json"})," configuration file:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'bash -c \'cat > /opt/dmq/config-relay.json << EOF\n{\n  "CardanoNetworkMagic": **YOUR_CARDANO_NETWORK_MAGIC**,\n  "CardanoNodeSocket": "**YOUR_CARDANO_NODE_SOCKET_PATH**"\n  "PeerSharing": true,\n  "LocalMsgSubmissionTracer": true,\n  "LocalMsgNotificationTracer": true,\n  "ConnectionManagerTracer": true,\n  "DiffusionTracer": true,\n  "InboundGovernorTracer": true,\n  "LocalInboundGovernorTracer": true,\n  "PeerSelectionTracer": true,\n  "PeerSelectionCounters": true,\n  "SigSubmissionLogicTracer": true,\n  "SigSubmissionClientTracer": true,\n  "SigSubmissionServerTracer": true,\n  "SigSubmissionClientProtocolTracer": true,\n  "SigSubmissionServerProtocolTracer": true,\n  "MuxTracer": true,\n  "ChannelTracer": false,\n  "DebugPeerSelectionTracer": true,\n  "ValidationTracer": true\n}\nEOF\'\n'})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"pre-release-preview"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'bash -c \'cat > /opt/dmq/config-relay.json << EOF\n{\n  "CardanoNetworkMagic": 2,\n  "CardanoNodeSocket": "/cardano/ipc/node.socket"\n  "PeerSharing": true,\n  "LocalMsgSubmissionTracer": true,\n  "LocalMsgNotificationTracer": true,\n  "ConnectionManagerTracer": true,\n  "DiffusionTracer": true,\n  "InboundGovernorTracer": true,\n  "LocalInboundGovernorTracer": true,\n  "PeerSelectionTracer": true,\n  "PeerSelectionCounters": true,\n  "SigSubmissionLogicTracer": true,\n  "SigSubmissionClientTracer": true,\n  "SigSubmissionServerTracer": true,\n  "SigSubmissionClientProtocolTracer": true,\n  "SigSubmissionServerProtocolTracer": true,\n  "MuxTracer": true,\n  "ChannelTracer": false,\n  "DebugPeerSelectionTracer": true,\n  "ValidationTracer": true\n}\nEOF\'\n'})})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For a ",(0,s.jsx)(n.strong,{children:"DMQ node on the block-producer machine"}),", create a ",(0,s.jsx)(n.code,{children:"/opt/dmq/config-bp.json"})," configuration file:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'bash -c \'cat > /opt/dmq/config-bp.json << EOF\n{\n  "CardanoNetworkMagic": **YOUR_CARDANO_NETWORK_MAGIC**,\n  "CardanoNodeSocket": "**YOUR_CARDANO_NODE_SOCKET_PATH**"\n  "PeerSharing": false,\n  "LocalMsgSubmissionTracer": true,\n  "LocalMsgNotificationTracer": true,\n  "ConnectionManagerTracer": true,\n  "DiffusionTracer": true,\n  "InboundGovernorTracer": true,\n  "LocalInboundGovernorTracer": true,\n  "PeerSelectionTracer": true,\n  "PeerSelectionCounters": true,\n  "SigSubmissionLogicTracer": true,\n  "SigSubmissionClientTracer": true,\n  "SigSubmissionServerTracer": true,\n  "SigSubmissionClientProtocolTracer": true,\n  "SigSubmissionServerProtocolTracer": true,\n  "MuxTracer": true,\n  "ChannelTracer": false,\n  "DebugPeerSelectionTracer": true,\n  "ValidationTracer": true\n}\nEOF\'\n'})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"pre-release-preview"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'bash -c \'cat > /opt/dmq/config-bp.json << EOF\n{\n  "CardanoNetworkMagic": 2,\n  "CardanoNodeSocket": "/cardano/ipc/node.socket"\n  "PeerSharing": false,\n  "LocalMsgSubmissionTracer": true,\n  "LocalMsgNotificationTracer": true,\n  "ConnectionManagerTracer": true,\n  "DiffusionTracer": true,\n  "InboundGovernorTracer": true,\n  "LocalInboundGovernorTracer": true,\n  "PeerSelectionTracer": true,\n  "PeerSelectionCounters": true,\n  "SigSubmissionLogicTracer": true,\n  "SigSubmissionClientTracer": true,\n  "SigSubmissionServerTracer": true,\n  "SigSubmissionClientProtocolTracer": true,\n  "SigSubmissionServerProtocolTracer": true,\n  "MuxTracer": true,\n  "ChannelTracer": false,\n  "DebugPeerSelectionTracer": true,\n  "ValidationTracer": true\n}\nEOF\'\n'})})]}),"\n",(0,s.jsx)(n.h4,{id:"prepare-the-topology-file-for-the-dmq-node",children:"Prepare the topology file for the DMQ node"}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["The DMQ node's topology file follows a similar format to the Cardano node's topology file. More information is available at ",(0,s.jsx)(n.a,{href:"https://developers.cardano.org/docs/get-started/infrastructure/node/topology/",children:"Cardano node topology"}),"."]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For a ",(0,s.jsx)(n.strong,{children:"DMQ node on the relay machine"}),", create a ",(0,s.jsx)(n.code,{children:"/opt/dmq/topology-relay.json"})," configuration file:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'bash -c \'cat > /opt/dmq/topology-relay.json << EOF\n{\n  "bootstrapPeers": [],\n  "localRoots": [\n    {\n      "accessPoints": [\n        {\n          "address": "**YOUR_DMQ_BOOTSTRAP_PEER_ADDRESS**",\n          "port": **YOUR_DMQ_BOOTSTRAP_PEER_PORT**,\n          "valency": 1\n        }\n      ],\n      "advertise": true,\n      "trustable": false,\n      "valency": 2\n    }\n  ],\n  "peerSnapshotFile": null,\n  "publicRoots": [\n    {\n      "accessPoints": [],\n      "advertise": false\n    }\n  ]\n}\nEOF\'\n'})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"pre-release-preview"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'bash -c \'cat > /opt/dmq/topology-relay.json << EOF\n{\n  "bootstrapPeers": [],\n  "localRoots": [\n    {\n      "accessPoints": [\n        {\n          "address": "34.76.22.193",\n          "port": 6161,\n          "valency": 1\n        }\n      ],\n      "advertise": true,\n      "trustable": false,\n      "valency": 2\n    }\n  ],\n  "peerSnapshotFile": null,\n  "publicRoots": [\n    {\n      "accessPoints": [],\n      "advertise": false\n    }\n  ]\n}\nEOF\'\n'})})]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For a ",(0,s.jsx)(n.strong,{children:"DMQ node on the block-producer machine"}),", create a ",(0,s.jsx)(n.code,{children:"/opt/dmq/topology-bp.json"})," configuration file:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'bash -c \'cat > /opt/dmq/topology-bp.json << EOF\n{\n  "bootstrapPeers": [],\n  "localRoots": [\n    {\n      "accessPoints": [\n        {\n          "address": "**YOUR_DMQ_NODE_RELAY_INTERNAL_ADDRESS**",\n          "port": **YOUR_DMQ_NODE_RELAY_PORT**,\n          "valency": 1\n        }\n      ],\n      "advertise": false,\n      "trustable": false,\n      "valency": 2\n    }\n  ],\n  "peerSnapshotFile": null,\n  "publicRoots": [\n    {\n      "accessPoints": [],\n      "advertise": false\n    }\n  ]\n}\nEOF\'\n'})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"pre-release-preview"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:'bash -c \'cat > /opt/dmq/topology-bp.json << EOF\n{\n  "bootstrapPeers": [],\n  "localRoots": [\n    {\n      "accessPoints": [\n        {\n          "address": "192.168.1.30",\n          "port": 6161,\n          "valency": 1\n        }\n      ],\n      "advertise": false,\n      "trustable": false,\n      "valency": 2\n    }\n  ],\n  "peerSnapshotFile": null,\n  "publicRoots": [\n    {\n      "accessPoints": [],\n      "advertise": false\n    }\n  ]\n}\nEOF\'\n'})})]}),"\n",(0,s.jsx)(n.h4,{id:"set-up-the-service-1",children:"Set up the service"}),"\n",(0,s.jsx)(n.admonition,{type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"User=cardano"}),":\nReplace this value with the correct user. We assume that the user running the ",(0,s.jsx)(n.strong,{children:"Cardano node"})," is ",(0,s.jsx)(n.code,{children:"cardano"}),". The ",(0,s.jsx)(n.strong,{children:"DMQ node"})," must imperatively run with the same user."]}),"\n"]})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For a ",(0,s.jsx)(n.strong,{children:"DMQ node on the relay machine"}),", create a ",(0,s.jsx)(n.code,{children:"/etc/systemd/system/dmq-relay.service"})," description file for the service:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat > /etc/systemd/system/dmq-relay.service << EOF\n[Unit]\nDescription=DMQ relay service\nStartLimitIntervalSec=0\n\n[Service]\nType=simple\nRestart=always\nRestartSec=60\nUser=cardano\nExecStart=/opt/dmq/dmq-node --configuration-file /opt/dmq/config-relay.json --topology-file /opt/dmq/topology-relay.json --local-socket **YOUR_DMQ_NODE_SOCKET_PATH** --host-addr **YOUR_DMQ_NODE_RELAY_PUBLIC_ADDRESS** --port **YOUR_DMQ_NODE_RELAY_PORT**\n\n[Install]\nWantedBy=multi-user.target\nEOF'\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"pre-release-preview"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat > /etc/systemd/system/dmq-relay.service << EOF\n[Unit]\nDescription=DMQ relay service\nStartLimitIntervalSec=0\n\n[Service]\nType=simple\nRestart=always\nRestartSec=60\nUser=cardano\nExecStart=/opt/dmq/dmq-node --configuration-file /opt/dmq/config-relay.json --topology-file /opt/dmq/topology-relay.json --local-socket /dmq/ipc/node.socket --host-addr 34.14.65.160 --port 6161\n\n[Install]\nWantedBy=multi-user.target\nEOF'\n"})})]}),"\n",(0,s.jsx)(n.p,{children:"Reload the service configuration (optional):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then, start the service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl start dmq-relay\n"})}),"\n",(0,s.jsx)(n.p,{children:"Register the service to start on boot:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable dmq-relay\n"})}),"\n",(0,s.jsx)(n.p,{children:"Monitor the status of the service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"systemctl status dmq-relay.service\n"})}),"\n",(0,s.jsx)(n.p,{children:"Finally, monitor the logs of the service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tail -f /var/log/syslog | grep dmq-relay\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For a ",(0,s.jsx)(n.strong,{children:"DMQ node on the block-producer machine"}),", create a ",(0,s.jsx)(n.code,{children:"/etc/systemd/system/dmq-bp.service"})," description file for the service:"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat > /etc/systemd/system/dmq-bp.service << EOF\n[Unit]\nDescription=DMQ block-producer service\nStartLimitIntervalSec=0\n\n[Service]\nType=simple\nRestart=always\nRestartSec=60\nUser=cardano\nExecStart=/opt/dmq/dmq-node --configuration-file /opt/dmq/config-bp.json --topology-file /opt/dmq/topology-bp.json --local-socket **YOUR_DMQ_NODE_SOCKET_PATH** --host-addr **YOUR_DMQ_NODE_BLOCK_PRODUCER_INTERNAL_ADDRESS** --port **YOUR_DMQ_NODE_BLOCK_PRODUCER_PORT**\n\n[Install]\nWantedBy=multi-user.target\nEOF'\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"pre-release-preview"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat > /etc/systemd/system/dmq-bp.service << EOF\n[Unit]\nDescription=DMQ block-producer service\nStartLimitIntervalSec=0\n\n[Service]\nType=simple\nRestart=always\nRestartSec=60\nUser=cardano\nExecStart=/opt/dmq/dmq-node --configuration-file /opt/dmq/config-bp.json --topology-file /opt/dmq/topology-bp.json --local-socket /dmq/ipc/node.socket --host-addr 192.168.1.60 --port 6161\n\n[Install]\nWantedBy=multi-user.target\nEOF'\n"})})]}),"\n",(0,s.jsx)(n.p,{children:"Reload the service configuration (optional):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl daemon-reload\n"})}),"\n",(0,s.jsx)(n.p,{children:"Then, start the service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl start dmq-bp\n"})}),"\n",(0,s.jsx)(n.p,{children:"Register the service to start on boot:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo systemctl enable dmq-bp\n"})}),"\n",(0,s.jsx)(n.p,{children:"Monitor the status of the service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"systemctl status dmq-bp.service\n"})}),"\n",(0,s.jsx)(n.p,{children:"Finally, monitor the logs of the service:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"tail -f /var/log/syslog | grep dmq-bp\n"})}),"\n",(0,s.jsx)(n.h3,{id:"update-the-configuration-of-the-mithril-signer",children:"Update the configuration of the Mithril signer"}),"\n",(0,s.jsxs)(n.p,{children:["The Mithril signer node must be configured to use the DMQ node (use the ",(0,s.jsx)(n.strong,{children:"block-producer"})," DMQ node socket path for the ",(0,s.jsx)(n.strong,{children:"production"})," deployment):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-signer.env << EOF\nDMQ_NODE_SOCKET_PATH=**YOUR_DMQ_NODE_SOCKET_PATH**\nEOF'\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"pre-release-preview"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-signer.env << EOF\nDMQ_NODE_SOCKET_PATH=/dmq/ipc/node.socket\nEOF'\n"})})]}),"\n",(0,s.jsx)(n.h3,{id:"firewall-configuration-1",children:"Firewall configuration"}),"\n",(0,s.jsx)(n.p,{children:"You should use a configuration that is very similar to your Cardano nodes' configuration:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["For the ",(0,s.jsx)(n.strong,{children:"DMQ node on the relay machine"}),", allow incoming traffic on the listening port of your DMQ relay node from the ",(0,s.jsx)(n.strong,{children:"Cardano block producer"})," machine"]}),"\n",(0,s.jsxs)(n.li,{children:["For the ",(0,s.jsx)(n.strong,{children:"DMQ node on the block-producer machine"}),", allow incoming traffic on the listening port of your DMQ block-producer node from the ",(0,s.jsx)(n.strong,{children:"DMQ relay"})," machine only."]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"tip",children:(0,s.jsxs)(n.p,{children:["More information about the recommended firewall configuration of the Cardano node is available at ",(0,s.jsx)(n.a,{href:"https://developers.cardano.org/docs/operate-a-stake-pool/deployment-scenarios/hardening-server/#7--firewall-configuration",children:"Cardano firewall configuration"}),"."]})}),"\n",(0,s.jsx)(n.h2,{id:"verify-the-mithril-signer-deployment",children:"Verify the Mithril signer deployment"}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["There is a delay of ",(0,s.jsx)(n.code,{children:"2"})," epochs between the signer node's registration and its ability to generate individual signatures. This delay is further explained in the ",(0,s.jsx)(n.a,{href:"https://mithril.network/doc/mithril/mithril-protocol/certificates",children:"Mithril certificate chain in depth"})," documentation."]}),(0,s.jsxs)(n.p,{children:["Once this delay has passed, you should be able to observe your ",(0,s.jsx)(n.code,{children:"PoolId"})," listed in some of the certificates accessible on the ",(0,s.jsx)(n.a,{href:"https://mithril.network/explorer",children:(0,s.jsx)(n.code,{children:"Mithril explorer"})}),"."]})]}),"\n",(0,s.jsx)(n.h3,{id:"verify-your-signer-is-registered",children:"Verify your signer is registered"}),"\n",(0,s.jsx)(n.p,{children:"After installing the Mithril signer, you can verify that your node is registered."}),"\n",(0,s.jsx)(n.p,{children:"First, download the script into the desired directory:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"wget https://mithril.network/doc/scripts/verify_signer_registration.sh\n"})}),"\n",(0,s.jsx)(n.p,{children:"Make the script executable:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"chmod +x verify_signer_registration.sh\n"})}),"\n",(0,s.jsx)(n.p,{children:"Finally, execute the script:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"PARTY_ID=**YOUR_PARTY_ID** AGGREGATOR_ENDPOINT=**YOUR_AGGREGATOR_ENDPOINT** ./verify_signer_registration.sh\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)(n.p,{children:"Here is an example command:"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"PARTY_ID=pool1hp72sauk0g0yqm4dzllz0pz6j93gewhllkzphn4hykkfmne43y AGGREGATOR_ENDPOINT=https://aggregator.release-preprod.api.mithril.network/aggregator ./verify_signer_registration.sh\n"})})]}),"\n",(0,s.jsx)(n.p,{children:"If your signer is registered, you should see this message:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:">> Congrats, your signer node is registered!\n"})}),"\n",(0,s.jsx)(n.p,{children:"Otherwise, you should see this error message:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:">> Oops, your signer node is not registered. Party ID not found among the signers registered at epoch 430.\n"})}),"\n",(0,s.jsx)(n.h3,{id:"verify-your-signer-contributes-with-individual-signatures",children:"Verify your signer contributes with individual signatures"}),"\n",(0,s.jsx)(n.p,{children:"After waiting for two epochs, you will be able to verify that your signer is contributing with individual signatures."}),"\n",(0,s.jsx)(n.p,{children:"First, download the script into the desired directory:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"wget https://mithril.network/doc/scripts/verify_signer_signature.sh\n"})}),"\n",(0,s.jsx)(n.p,{children:"Make the script executable:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"chmod +x verify_signer_signature.sh\n"})}),"\n",(0,s.jsx)(n.p,{children:"Finally, execute the script:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"PARTY_ID=**YOUR_PARTY_ID** AGGREGATOR_ENDPOINT=**YOUR_AGGREGATOR_ENDPOINT** ./verify_signer_signature.sh\n"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsxs)(n.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,s.jsx)(n.code,{children:"release-preprod"}),":"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"PARTY_ID=pool1hp72sauk0g0yqm4dzllz0pz6j93gewhllkzphn4hykkfmne43y AGGREGATOR_ENDPOINT=https://aggregator.release-preprod.api.mithril.network/aggregator ./verify_signer_signature.sh\n"})})]}),"\n",(0,s.jsx)(n.p,{children:"If your signer is contributing, you should see this message:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:">> Congrats, you have signed this certificate: https://aggregator.release-preprod.api.mithril.network/aggregator/certificate/el3p289b03a223244285b2ls10839846ae7a69f1e8362824a383f376f93f723f !\n"})}),"\n",(0,s.jsx)(n.p,{children:"Otherwise, you should see this error message:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:">> Oops, your party id was not found in the last 20 certificates. Please try again later.\n"})})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}},29117(e,n,r){r.d(n,{A:()=>i});const i=r.p+"assets/files/cardano-transaction-signer-cpu-cf28c3fd8ce40f5e5a38f70eeddd39c0.png"},44142(e,n,r){r.d(n,{A:()=>i});const i=r.p+"assets/files/cardano-transaction-signer-disk-usage-432e8b0e75e95e940fa9f95c4966aca9.png"},48677(e,n,r){r.d(n,{A:()=>i});const i=r.p+"assets/files/cardano-transaction-signer-res-memory-feffbc7b136f8e1eaa387375d4342123.png"},68880(e,n,r){r.d(n,{A:()=>i});const i=r.p+"assets/files/signer-deployment-naive-6f2cc44fb5738b30cc3b5c370042845a.jpg"},94974(e,n,r){r.d(n,{A:()=>i});const i=r.p+"assets/files/signer-deployment-production-691bb17c165b4da09c46222bc71c06ac.jpg"},98817(e,n,r){r.d(n,{A:()=>i});const i=r.p+"assets/images/cardano-transaction-signer-cpu-cf28c3fd8ce40f5e5a38f70eeddd39c0.png"},9690(e,n,r){r.d(n,{A:()=>i});const i=r.p+"assets/images/cardano-transaction-signer-disk-usage-432e8b0e75e95e940fa9f95c4966aca9.png"},37769(e,n,r){r.d(n,{A:()=>i});const i=r.p+"assets/images/cardano-transaction-signer-res-memory-feffbc7b136f8e1eaa387375d4342123.png"},23468(e,n,r){r.d(n,{A:()=>i});const i=r.p+"assets/images/signer-deployment-naive-6f2cc44fb5738b30cc3b5c370042845a.jpg"},31146(e,n,r){r.d(n,{A:()=>i});const i=r.p+"assets/images/signer-deployment-production-691bb17c165b4da09c46222bc71c06ac.jpg"}}]);