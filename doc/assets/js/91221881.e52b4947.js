"use strict";(globalThis.webpackChunkmithril_doc=globalThis.webpackChunkmithril_doc||[]).push([[5473,7315],{3393(e,r,n){n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>l,default:()=>g,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"compiled-binaries","title":"compiled-binaries","description":"You can install a the latest released binary of the {props.node} by running this one line command (replace **YOURPATH with your installation path_):","source":"@site/root/compiled-binaries.mdx","sourceDirName":".","slug":"/compiled-binaries","permalink":"/doc/next/compiled-binaries","draft":false,"unlisted":true,"editUrl":"https://github.com/input-output-hk/mithril/edit/main/docs/website/root/compiled-binaries.mdx","tags":[],"version":"current","frontMatter":{"unlisted":true,"hide_title":true,"hide_table_of_contents":true}}');var t=n(74848),s=n(28453),a=n(83457);const o={unlisted:!0,hide_title:!0,hide_table_of_contents:!0},l=void 0,c={},d=[];function h(e){const r={a:"a",admonition:"admonition",code:"code",em:"em",li:"li",p:"p",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.p,{children:["You can install a the ",(0,t.jsx)(r.strong,{children:"latest"})," released binary of the ",(0,t.jsx)(r.strong,{children:e.node})," by running this one line command (",(0,t.jsxs)(r.em,{children:["replace ",(0,t.jsx)(r.strong,{children:"YOUR_PATH"})," with your installation path"]}),"):"]}),"\n",(0,t.jsx)(a.A,{language:"bash",children:(0,t.jsxs)(r.p,{children:["curl --proto '=https' --tlsv1.2 -sSf\n",(0,t.jsx)(r.a,{href:"https://raw.githubusercontent.com/input-output-hk/mithril/refs/heads/main/mithril-install.sh",children:"https://raw.githubusercontent.com/input-output-hk/mithril/refs/heads/main/mithril-install.sh"}),"\n| sh -s -- -c ",e.node," -d latest -p ",(0,t.jsx)(r.strong,{children:"YOUR_PATH"})]})}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsxs)(r.p,{children:["You can also install the ",(0,t.jsx)(r.strong,{children:e.node})," binary for other distributions:"]}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["use ",(0,t.jsx)(r.code,{children:"-d unstable"})," for the ",(0,t.jsx)(r.strong,{children:"unstable"})," version"]}),"\n",(0,t.jsxs)(r.li,{children:["use ",(0,t.jsx)(r.code,{children:"-d **DISTRIBUTION_VERSION**"})," for a specific distribution (e.g. ",(0,t.jsx)(r.code,{children:"-d 2445.0"}),")"]}),"\n"]})]}),"\n",(0,t.jsx)(r.admonition,{type:"info",children:(0,t.jsxs)(r.p,{children:["The Linux binaries target ",(0,t.jsx)(r.code,{children:"glibc"}),", and have a minimum requirement of ",(0,t.jsx)(r.code,{children:"glibc 2.35"})," (compatible with ",(0,t.jsx)(r.code,{children:"Ubuntu 22.04"}),"\nor ",(0,t.jsx)(r.code,{children:"Debian 12 - Bookworm"}),")."]})})]})}function g(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},67033(e,r,n){n.r(r),n.d(r,{assets:()=>c,contentTitle:()=>l,default:()=>g,frontMatter:()=>o,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"manual/operate/run-aggregator-node","title":"Run a Mithril aggregator node","description":"Running multiple Mithril aggregators on a Mithril network is enabled by the DMQ protocol, which is currently unstable and not suitable for production use.","source":"@site/root/manual/operate/run-aggregator-node.md","sourceDirName":"manual/operate","slug":"/manual/operate/run-aggregator-node","permalink":"/doc/next/manual/operate/run-aggregator-node","draft":false,"unlisted":false,"editUrl":"https://github.com/input-output-hk/mithril/edit/main/docs/website/root/manual/operate/run-aggregator-node.md","tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"manualSideBar","previous":{"title":"Run a Mithril signer node","permalink":"/doc/next/manual/operate/run-signer-node"},"next":{"title":"Develop","permalink":"/doc/next/manual/develop/"}}');var t=n(74848),s=n(28453),a=n(3393);const o={sidebar_position:4},l="Run a Mithril aggregator node",c={},d=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Hardware",id:"hardware",level:2},{value:"Set up the Mithril aggregator node",id:"set-up-the-mithril-aggregator-node",level:2},{value:"Building your own Mithril aggregator executable",id:"building-your-own-mithril-aggregator-executable",level:3},{value:"Download the source file",id:"download-the-source-file",level:4},{value:"Build the Mithril aggregator binary",id:"build-the-mithril-aggregator-binary",level:4},{value:"Download the pre-built binary",id:"download-the-pre-built-binary",level:3},...a.toc,{value:"Verifying the binary",id:"verifying-the-binary",level:3},{value:"Verify the version of the binary",id:"verify-the-version-of-the-binary",level:4},{value:"Verify the build",id:"verify-the-build",level:4},{value:"Installing the service",id:"installing-the-service",level:3},{value:"Move the executable",id:"move-the-executable",level:4},{value:"Set up the service",id:"set-up-the-service",level:4},{value:"Activate a Prometheus endpoint",id:"activate-a-prometheus-endpoint",level:3},{value:"Set up the SSL certificate (Traefik)",id:"set-up-the-ssl-certificate-traefik",level:2},{value:"Download the pre-built binary",id:"download-the-pre-built-binary-1",level:3},{value:"Installing the service",id:"installing-the-service-1",level:3},{value:"Make the binary executable",id:"make-the-binary-executable",level:4},{value:"Move the executable",id:"move-the-executable-1",level:4},{value:"Prepare the configuration directories",id:"prepare-the-configuration-directories",level:4},{value:"Prepare the static configuration file",id:"prepare-the-static-configuration-file",level:4},{value:"Prepare the dynamic configuration file",id:"prepare-the-dynamic-configuration-file",level:4},{value:"Prepare the acme.json file",id:"prepare-the-acmejson-file",level:4},{value:"Create the service user",id:"create-the-service-user",level:4},{value:"Set up the service",id:"set-up-the-service-1",level:4},{value:"Set up the DMQ node (unstable)",id:"set-up-the-dmq-node-unstable",level:2},{value:"Download the pre-built binary",id:"download-the-pre-built-binary-2",level:3},{value:"Installing the service",id:"installing-the-service-2",level:3},{value:"Move the executable",id:"move-the-executable-2",level:4},{value:"Prepare the configuration file of the DMQ node",id:"prepare-the-configuration-file-of-the-dmq-node",level:4},{value:"Prepare the topology file for the DMQ node",id:"prepare-the-topology-file-for-the-dmq-node",level:4},{value:"Set up the service",id:"set-up-the-service-2",level:4},{value:"Update the configuration of the Mithril aggregator",id:"update-the-configuration-of-the-mithril-aggregator",level:3},{value:"Verify the Mithril aggregator deployment",id:"verify-the-mithril-aggregator-deployment",level:2},{value:"Monitor your aggregator with the Mithril explorer",id:"monitor-your-aggregator-with-the-mithril-explorer",level:3},{value:"Register your aggregator for automatic discovery (unstable)",id:"register-your-aggregator-for-automatic-discovery-unstable",level:3}];function h(e){const r={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(r.header,{children:(0,t.jsx)(r.h1,{id:"run-a-mithril-aggregator-node",children:"Run a Mithril aggregator node"})}),"\n",(0,t.jsx)(r.admonition,{type:"danger",children:(0,t.jsxs)(r.p,{children:["Running multiple Mithril aggregators on a Mithril network is enabled by the DMQ protocol, which is currently ",(0,t.jsx)(r.strong,{children:"unstable"})," and not suitable for production use."]})}),"\n",(0,t.jsx)(r.admonition,{type:"info",children:(0,t.jsx)(r.p,{children:"You don't need to be a Cardano SPO to run a Mithril aggregator node."})}),"\n",(0,t.jsx)(r.admonition,{type:"tip",children:(0,t.jsxs)(r.p,{children:["For more information about the ",(0,t.jsx)(r.strong,{children:"Mithril protocol"}),", see the ",(0,t.jsx)(r.a,{href:"/doc/next/mithril/intro",children:"About Mithril"})," section."]})}),"\n",(0,t.jsx)(r.p,{children:"On a Mithril network, there exist two types of aggregator nodes:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Leader aggregator node"}),": this node is managed by the entity that generates genesis certificates of the Mithril network (Input Output for all networks specified in the ",(0,t.jsx)(r.a,{href:"/doc/next/manual/getting-started/network-configurations",children:"Network configurations"}),". It is responsible for collecting signer registrations (which is still a centralized process) and broadcasting them to other nodes of the network. It provides also a bootstrap point for other aggregator nodes to synchronize the certificate chain."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Follower aggregator node"}),": this node is managed by any entity willing to contribute to the Mithril network reliability or to provide additional availability guarantees to an infrastructure (eg, for a bridge powered by Mithril). This document explains how to set up and run such a follower Mithril aggregator node."]}),"\n"]}),"\n",(0,t.jsx)(r.admonition,{type:"info",children:(0,t.jsxs)(r.p,{children:["The follower aggregator listens to signatures diffused by the SPOs' Mithril signer nodes and produces Mithril certificates accordingly. Until the DMQ protocol is stabilized and widely deployed (at least ",(0,t.jsx)(r.strong,{children:"60%"})," of stake registered in the Mithril protocol operating it), the follower aggregator will not be able to produce certificates."]})}),"\n",(0,t.jsx)(r.p,{children:"Every follower aggregator node is free to select the types of data it wants to support certification for:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Cardano database v2"}),(0,t.jsx)("sup",{children:"(*)"})]}),"\n",(0,t.jsx)(r.li,{children:(0,t.jsx)(r.strong,{children:"Cardano transactions"})}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Cardano stake distribution"}),"."]}),"\n"]}),"\n",(0,t.jsx)(r.p,{children:(0,t.jsxs)(r.em,{children:[(0,t.jsx)("sup",{children:"(*)"}),": requires access to GCP to store Cardano database and may incur costs."]})}),"\n",(0,t.jsx)(r.admonition,{type:"tip",children:(0,t.jsxs)(r.p,{children:["For more information about the ",(0,t.jsx)(r.strong,{children:"supported data"}),", see the ",(0,t.jsx)(r.a,{href:"/doc/next/mithril/advanced/mithril-certification/",children:"Mithril certification"})," section."]})}),"\n",(0,t.jsx)(r.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(r.admonition,{type:"info",children:(0,t.jsx)(r.p,{children:"Note that this guide works only on a Linux machine."})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["Operate a ",(0,t.jsx)(r.strong,{children:"Cardano full node"})]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["To access the file system of the ",(0,t.jsx)(r.strong,{children:"Cardano full node"}),", you will need the following permissions:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Read rights on the ",(0,t.jsx)(r.code,{children:"Database"})," folder (specified by the ",(0,t.jsx)(r.code,{children:"--database-path"})," setting of the ",(0,t.jsx)(r.strong,{children:"Cardano node"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:["Read and write rights on the ",(0,t.jsx)(r.code,{children:"Inter Process Communication"})," file (typically defined by the ",(0,t.jsx)(r.code,{children:"CARDANO_NODE_SOCKET_PATH"})," environment variable used to launch the ",(0,t.jsx)(r.strong,{children:"Cardano node"}),")"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["Install a correctly configured Rust toolchain (latest stable version); you can follow the instructions provided ",(0,t.jsx)(r.a,{href:"https://www.rust-lang.org/learn/get-started",children:"here"})]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["Install build tools ",(0,t.jsx)(r.code,{children:"build-essential"})," and ",(0,t.jsx)(r.code,{children:"m4"}),"; for example, on Ubuntu/Debian/Mint, run ",(0,t.jsx)(r.code,{children:"sudo apt install build-essential m4"})]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["Install OpenSSL development libraries; for example, on Ubuntu/Debian/Mint, run ",(0,t.jsx)(r.code,{children:"apt install libssl-dev"})]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["Install a recent version of ",(0,t.jsx)(r.code,{children:"jq"})," (version 1.6+) by running ",(0,t.jsx)(r.code,{children:"apt install jq"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.h2,{id:"hardware",children:"Hardware"}),"\n",(0,t.jsx)(r.p,{children:"Running a Mithril aggregator node requires sufficient hardware resources. We recommend using a virtual machine or dedicated server with the following specifications:"}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"CPU"}),":","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["For test networks (",(0,t.jsx)(r.code,{children:"preprod"}),", ",(0,t.jsx)(r.code,{children:"preview"}),"): At least 4 vCPUs"]}),"\n",(0,t.jsxs)(r.li,{children:["For ",(0,t.jsx)(r.code,{children:"mainnet"}),": At least 8 vCPUs"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"RAM"}),":","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["For test networks (",(0,t.jsx)(r.code,{children:"preprod"}),", ",(0,t.jsx)(r.code,{children:"preview"}),"): 16 GB minimum, 32 GB recommended"]}),"\n",(0,t.jsxs)(r.li,{children:["For ",(0,t.jsx)(r.code,{children:"mainnet"}),": 32 GB minimum, 64 GB recommended"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"Storage"}),": At least 500 GB of disk space."]}),"\n"]}),"\n",(0,t.jsx)(r.admonition,{type:"info",children:(0,t.jsx)(r.p,{children:"The actual resource requirements may vary depending on the signed entity types you choose to support. Supporting Cardano database snapshots and transaction certification will require more storage and processing power than supporting only stake distributions."})}),"\n",(0,t.jsx)(r.h2,{id:"set-up-the-mithril-aggregator-node",children:"Set up the Mithril aggregator node"}),"\n",(0,t.jsxs)(r.admonition,{type:"info",children:[(0,t.jsxs)(r.p,{children:["Compare the version of your Cardano node with the minimum supported versions listed in the ",(0,t.jsx)(r.a,{href:"https://github.com/input-output-hk/mithril/blob/main/networks.json",children:(0,t.jsx)(r.code,{children:"networks.json"})})," file to verify its compatibility with the Mithril aggregator."]}),(0,t.jsx)(r.p,{children:"First, check the version of your Cardano node by running the following command:"}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"cardano-node --version\n"})}),(0,t.jsxs)(r.p,{children:["Then, refer to the minimum supported versions listed in the ",(0,t.jsx)(r.a,{href:"https://github.com/input-output-hk/mithril/blob/main/networks.json",children:(0,t.jsx)(r.code,{children:"networks.json"})})," file."]}),(0,t.jsx)(r.p,{children:"You can also fetch the minimum supported version for your network using the command below:"}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'wget -q -O - https://raw.githubusercontent.com/input-output-hk/mithril/main/networks.json | jq -r \'."**YOUR_CARDANO_NETWORK**"."cardano-minimum-version"."mithril-aggregator"\'\n'})}),(0,t.jsxs)(r.p,{children:["Here is an example for ",(0,t.jsx)(r.code,{children:"preprod"}),":"]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'wget -q -O - https://raw.githubusercontent.com/input-output-hk/mithril/main/networks.json | jq -r \'."preprod"."cardano-minimum-version"."mithril-aggregator"\'\n'})})]}),"\n",(0,t.jsx)(r.h3,{id:"building-your-own-mithril-aggregator-executable",children:"Building your own Mithril aggregator executable"}),"\n",(0,t.jsx)(r.h4,{id:"download-the-source-file",children:"Download the source file"}),"\n",(0,t.jsx)(r.p,{children:"To download the source from GitHub (HTTPS), run:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"git clone https://github.com/input-output-hk/mithril.git\n"})}),"\n",(0,t.jsx)(r.p,{children:"Or (SSH):"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"git clone git@github.com:input-output-hk/mithril.git\n"})}),"\n",(0,t.jsx)(r.h4,{id:"build-the-mithril-aggregator-binary",children:"Build the Mithril aggregator binary"}),"\n",(0,t.jsx)(r.p,{children:"First, switch to build a branch/tag:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"# **YOUR_BUILD_BRANCH_OR_TAG** depends on the Mithril network you target,\n# please refer to the **Build from** column of the **Mithril networks** section\ngit checkout **YOUR_BUILD_BRANCH_OR_TAG**\n"})}),"\n",(0,t.jsx)(r.p,{children:"Then, change the directory:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"cd mithril/mithril-aggregator\n"})}),"\n",(0,t.jsx)(r.p,{children:"Run tests (optional):"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"make test\n"})}),"\n",(0,t.jsx)(r.p,{children:"Finally, build the executable:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"make build\n"})}),"\n",(0,t.jsx)(r.h3,{id:"download-the-pre-built-binary",children:"Download the pre-built binary"}),"\n",(0,t.jsx)(a.default,{node:"mithril-aggregator"}),"\n",(0,t.jsx)(r.h3,{id:"verifying-the-binary",children:"Verifying the binary"}),"\n",(0,t.jsx)(r.h4,{id:"verify-the-version-of-the-binary",children:"Verify the version of the binary"}),"\n",(0,t.jsx)(r.p,{children:"You can check if the Mithril aggregator binary is running the correct version by running:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"./mithril-aggregator -V\n"})}),"\n",(0,t.jsx)(r.p,{children:"You should see something like:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"mithril-aggregator 0.2.0\n"})}),"\n",(0,t.jsxs)(r.p,{children:["\u26a0\ufe0f"," Please verify that the displayed version matches the version described in the release/pre-release notes (refer to the ",(0,t.jsx)(r.strong,{children:"Build from"})," column in the ",(0,t.jsx)(r.strong,{children:"Mithril networks"})," section)."]}),"\n",(0,t.jsx)(r.h4,{id:"verify-the-build",children:"Verify the build"}),"\n",(0,t.jsx)(r.p,{children:"Check if the Mithril aggregator binary is working correctly by running the help function:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"./mithril-aggregator -h\n"})}),"\n",(0,t.jsx)(r.p,{children:"You should see:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"Mithril aggregator node\n\nUsage: mithril-aggregator [OPTIONS] <COMMAND>\n\nCommands:\n  genesis   Genesis tools\n  era       Era tools\n  serve     Server runtime mode\n  tools     List of tools to upkeep the aggregator\n  database  Database tools\n  help      Print this message or the help of the given subcommand(s)\n\nOptions:\n  -r, --run-mode <RUN_MODE>\n          Run mode [default: dev]\n  -v, --verbose...\n          Verbosity level\n      --db-directory <DB_DIRECTORY>\n          Directory of the Cardano node files\n      --config-directory <CONFIG_DIRECTORY>\n          Directory where the configuration file is located [default: ./config]\n  -h, --help\n          Print help\n  -V, --version\n          Print version\n"})}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsx)(r.p,{children:"If you wish to delve deeper, you can access logs at various levels from the Mithril aggregator:"}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Add ",(0,t.jsx)(r.code,{children:"-v"})," for some logs (WARN)"]}),"\n",(0,t.jsxs)(r.li,{children:["Add ",(0,t.jsx)(r.code,{children:"-vv"})," for more logs (INFO)"]}),"\n",(0,t.jsxs)(r.li,{children:["Add ",(0,t.jsx)(r.code,{children:"-vvv"})," for even more logs (DEBUG)"]}),"\n",(0,t.jsxs)(r.li,{children:["Add ",(0,t.jsx)(r.code,{children:"-vvvv"})," for all logs (TRACE)."]}),"\n"]})]}),"\n",(0,t.jsx)(r.h3,{id:"installing-the-service",children:"Installing the service"}),"\n",(0,t.jsx)(r.h4,{id:"move-the-executable",children:"Move the executable"}),"\n",(0,t.jsx)(r.p,{children:"To move the executable to /opt/mithril, run:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo mkdir -p /opt/mithril\nsudo mv mithril-aggregator /opt/mithril\n"})}),"\n",(0,t.jsx)(r.h4,{id:"set-up-the-service",children:"Set up the service"}),"\n",(0,t.jsxs)(r.admonition,{type:"caution",children:[(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"User=cardano"}),":\nReplace this value with the correct user. We assume that the user running the ",(0,t.jsx)(r.strong,{children:"Cardano node"})," is ",(0,t.jsx)(r.code,{children:"cardano"}),". The ",(0,t.jsx)(r.strong,{children:"Mithril aggregator"})," must run with the same user as the ",(0,t.jsx)(r.strong,{children:"Cardano node"})," to access the database and socket files."]}),"\n"]}),(0,t.jsxs)(r.p,{children:["The configuration values for the ",(0,t.jsx)(r.code,{children:"/opt/mithril/mithril-aggregator.env"})," file are described below:"]}),(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Base configuration"})," values are:"]}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"SIGNED_ENTITY_TYPES"}),": Comma-separated list of signed entity types to certify (eg, ",(0,t.jsx)(r.code,{children:"MithrilStakeDistribution,CardanoImmutableFilesFull,CardanoStakeDistribution,CardanoDatabase,CardanoTransactions"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"SERVER_PORT"}),": Listening server port (default: ",(0,t.jsx)(r.code,{children:"8080"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"PUBLIC_SERVER_URL"}),": Public URL of your aggregator (eg, ",(0,t.jsx)(r.code,{children:"https://aggregator.example.com/aggregator"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"LEADER_AGGREGATOR_ENDPOINT"}),": Endpoint of the leader aggregator to synchronize with (required for follower aggregators, can be found in the ",(0,t.jsx)(r.a,{href:"/doc/next/manual/getting-started/network-configurations",children:"Network configurations"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"RUN_INTERVAL"}),": Interval between two runtime cycles in milliseconds (eg, ",(0,t.jsx)(r.code,{children:"60000"})," for 60 seconds)"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"AGGREGATE_SIGNATURE_TYPE"}),": Type of aggregate signature to use (default: ",(0,t.jsx)(r.code,{children:"Concatenation"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"STORE_RETENTION_LIMIT"}),": Maximum number of records to keep in internal stores. If not set, no limit is applied. A value of ",(0,t.jsx)(r.code,{children:"5"})," is recommended to limit disk usage"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"NETWORK"}),": Cardano network name (eg, ",(0,t.jsx)(r.code,{children:"mainnet"}),", ",(0,t.jsx)(r.code,{children:"preprod"}),", or ",(0,t.jsx)(r.code,{children:"preview"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"NETWORK_MAGIC"}),": Cardano network magic number (required only if not using ",(0,t.jsx)(r.code,{children:"mainnet"}),", ",(0,t.jsx)(r.code,{children:"preprod"})," or ",(0,t.jsx)(r.code,{children:"preview"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"CARDANO_NODE_SOCKET_PATH"}),": Path to the IPC file of the Cardano node"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"CARDANO_NODE_VERSION"}),": Version of the Cardano node running (eg, ",(0,t.jsx)(r.code,{children:"10.5.0"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"CHAIN_OBSERVER_TYPE"}),": Type of chain observer (default: ",(0,t.jsx)(r.code,{children:"pallas"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"ERA_READER_ADAPTER_TYPE"}),": Type of era reader adapter to use (default: ",(0,t.jsx)(r.code,{children:"bootstrap"}),", use ",(0,t.jsx)(r.code,{children:"cardano-chain"})," for production networks as specified in ",(0,t.jsx)(r.a,{href:"/doc/next/manual/getting-started/network-configurations",children:"Network configurations"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"ERA_READER_ADAPTER_PARAMS"}),": JSON encoded parameters for the era reader adapter. For ",(0,t.jsx)(r.code,{children:"cardano-chain"})," type, compute using: ",(0,t.jsx)(r.code,{children:'jq -nc --arg address $(wget -q -O - **YOUR_ERA_READER_ADDRESS**) --arg verification_key $(wget -q -O - **YOUR_ERA_READER_VERIFICATION_KEY**) \'{"address": $address, "verification_key": $verification_key}\''})," (URLs can be found in the ",(0,t.jsx)(r.a,{href:"/doc/next/manual/getting-started/network-configurations",children:"Network configurations"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"GENESIS_VERIFICATION_KEY"}),": Genesis verification key for the Mithril network. Fetch using: ",(0,t.jsx)(r.code,{children:"wget -q -O - **YOUR_GENESIS_VERIFICATION_KEY**"})," (URL can be found in the ",(0,t.jsx)(r.a,{href:"/doc/next/manual/getting-started/network-configurations",children:"Network configurations"}),")"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"DMQ_NODE_SOCKET_PATH"}),": Path to the IPC file of the DMQ node"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.code,{children:"CUSTOM_ORIGIN_TAG_WHITE_LIST"}),": Comma-separated list of custom origin tags to whitelist for client requests (default: ",(0,t.jsx)(r.code,{children:"EXPLORER,BENCHMARK,CI,NA"}),")."]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Base configuration"})," ",(0,t.jsx)(r.strong,{children:"optional"})," values are:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"BLOCKFROST_PARAMETERS"}),": Parameters to connect to the Blockfrost API. Used to fetch the ticker and name of the registered stake pools. Example: ",(0,t.jsx)(r.code,{children:'{"project_id":"preprodWuV1ICdtOWfZYfdcxpZ0tsS1N9rVZomQ"}'})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"SIGNER_IMPORTER_RUN_INTERVAL"}),": Time interval at which the pools names and ticker in blockfrost will be imported (in minutes, default: ",(0,t.jsx)(r.code,{children:"720"}),")."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.strong,{children:"Cardano database"})," configuration values are (only needed if supporting Cardano database certification):"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"DB_DIRECTORY"}),": Directory of the Cardano node database stores (same as the ",(0,t.jsx)(r.code,{children:"--database-path"})," setting of the Cardano node)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"DATA_STORES_DIRECTORY"}),": Directory where the aggregator will store its databases (eg, ",(0,t.jsx)(r.code,{children:"/opt/mithril/stores"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"GOOGLE_APPLICATION_CREDENTIALS_JSON"}),": JSON content of the GCP service account credentials (required if using GCP for snapshot storage)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"GOOGLE_APPLICATION_CREDENTIALS_GCP_KMS_JSON"}),": JSON content of the GCP KMS credentials for signing (optional, for using GCP KMS to sign ancillary files)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"SNAPSHOT_UPLOADER_TYPE"}),": Type of snapshot uploader (",(0,t.jsx)(r.code,{children:"gcp"})," for Google Cloud Storage or ",(0,t.jsx)(r.code,{children:"local"})," for local storage)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"SNAPSHOT_BUCKET_NAME"}),": Name of the GCP bucket where snapshots are stored (required if ",(0,t.jsx)(r.code,{children:"SNAPSHOT_UPLOADER_TYPE"})," is ",(0,t.jsx)(r.code,{children:"gcp"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"SNAPSHOT_USE_CDN_DOMAIN"}),": Set to ",(0,t.jsx)(r.code,{children:"true"})," to use CDN domain for constructing snapshot URLs (default: ",(0,t.jsx)(r.code,{children:"false"}),", only relevant for GCP)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"SNAPSHOT_COMPRESSION_ALGORITHM"}),": Compression algorithm for snapshot archives (default: ",(0,t.jsx)(r.code,{children:"zstandard"}),", can also be ",(0,t.jsx)(r.code,{children:"gzip"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"ZSTANDARD_PARAMETERS__LEVEL"}),": Zstandard compression level (eg, ",(0,t.jsx)(r.code,{children:"9"})," for maximum compression, range 1-22)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"ZSTANDARD_PARAMETERS__NUMBER_OF_WORKERS"}),": Number of worker threads for Zstandard compression (eg, ",(0,t.jsx)(r.code,{children:"4"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"ANCILLARY_FILES_SIGNER_CONFIG"}),": JSON configuration for signing ancillary files. Can be either a secret key or a GCP KMS key. Example with secret key: ",(0,t.jsx)(r.code,{children:'{"type": "secret-key", "secret_key": "your_hex_encoded_secret_key"}'}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:["The ",(0,t.jsx)(r.strong,{children:"Cardano transactions"})," configuration values are (only needed if supporting Cardano transactions certification):"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"CARDANO_TRANSACTIONS_PROVER_CACHE_POOL_SIZE"}),": Size of the prover cache pool (default: ",(0,t.jsx)(r.code,{children:"10"}),"). This configuration can have a significant impact on the aggregator's memory usage. In particular, on ",(0,t.jsx)(r.code,{children:"mainnet"}),", we recommend avoiding values higher than ",(0,t.jsx)(r.code,{children:"10"}),"."]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"CARDANO_TRANSACTIONS_DATABASE_CONNECTION_POOL_SIZE"}),": Size of the database connection pool (default: ",(0,t.jsx)(r.code,{children:"10"}),")."]}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsxs)(r.p,{children:["Here is an ",(0,t.jsx)(r.strong,{children:"example"})," set of values for ",(0,t.jsx)(r.strong,{children:"release-preprod"})," that will be used in this guide in the ",(0,t.jsx)(r.strong,{children:"tip"})," boxes to illustrate some commands:"]}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Base configuration"}),":"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"SIGNED_ENTITY_TYPES"}),": ",(0,t.jsx)(r.code,{children:"MithrilStakeDistribution,CardanoStakeDistribution,CardanoTransactions"})," (only supporting stake distributions and transactions, excluding database snapshots)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"SERVER_PORT"}),": ",(0,t.jsx)(r.code,{children:"8080"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"PUBLIC_SERVER_URL"}),": ",(0,t.jsx)(r.code,{children:"https://aggregator.example.com/aggregator"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"LEADER_AGGREGATOR_ENDPOINT"}),": ",(0,t.jsx)(r.code,{children:"https://aggregator.release-preprod.api.mithril.network/aggregator"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"RUN_INTERVAL"}),": ",(0,t.jsx)(r.code,{children:"60000"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"AGGREGATE_SIGNATURE_TYPE"}),": ",(0,t.jsx)(r.code,{children:"Concatenation"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"STORE_RETENTION_LIMIT"}),": ",(0,t.jsx)(r.code,{children:"5"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"NETWORK"}),": ",(0,t.jsx)(r.code,{children:"preprod"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"NETWORK_MAGIC"}),": ",(0,t.jsx)(r.code,{children:"1"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"CARDANO_NODE_SOCKET_PATH"}),": ",(0,t.jsx)(r.code,{children:"/cardano/ipc/node.socket"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"CARDANO_NODE_VERSION"}),": ",(0,t.jsx)(r.code,{children:"10.5.0"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"CHAIN_OBSERVER_TYPE"}),": ",(0,t.jsx)(r.code,{children:"pallas"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"ERA_READER_ADAPTER_TYPE"}),": ",(0,t.jsx)(r.code,{children:"cardano-chain"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"ERA_READER_ADAPTER_PARAMS"}),": ",(0,t.jsx)(r.code,{children:'$(jq -nc --arg address $(wget -q -O - https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/release-preprod/era.addr) --arg verification_key $(wget -q -O - https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/release-preprod/era.vkey) \'{"address": $address, "verification_key": $verification_key}\')'})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"GENESIS_VERIFICATION_KEY"}),": ",(0,t.jsx)(r.code,{children:"$(wget -q -O - https://raw.githubusercontent.com/input-output-hk/mithril/main/mithril-infra/configuration/release-preprod/genesis.vkey)"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"DMQ_NODE_SOCKET_PATH"}),": ",(0,t.jsx)(r.code,{children:"/dmq/ipc/node.socket"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"CUSTOM_ORIGIN_TAG_WHITE_LIST"}),": ",(0,t.jsx)(r.code,{children:"EXPLORER,BENCHMARK,CI,NA"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Optional configuration"}),":"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"BLOCKFROST_PARAMETERS"}),": ",(0,t.jsx)(r.code,{children:'{"project_id":"preprodWuV1ICdtOWfZYfdcxpZ0tsS1N9rVZomQ"}'})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"SIGNER_IMPORTER_RUN_INTERVAL"}),": 720"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cardano database configuration"}),":"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"DB_DIRECTORY"}),": ",(0,t.jsx)(r.code,{children:"/cardano/db"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"DATA_STORES_DIRECTORY"}),": ",(0,t.jsx)(r.code,{children:"/opt/mithril/stores"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"GOOGLE_APPLICATION_CREDENTIALS_JSON"}),": ",(0,t.jsx)(r.code,{children:"**YOUR_SECRET**"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"GOOGLE_APPLICATION_CREDENTIALS_GCP_KMS_JSON"}),": ",(0,t.jsx)(r.code,{children:"**YOUR_SECRET**"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"SNAPSHOT_UPLOADER_TYPE"}),": ",(0,t.jsx)(r.code,{children:"local"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"SNAPSHOT_BUCKET_NAME"}),": ",(0,t.jsx)(r.code,{children:"mithril-snapshots"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"SNAPSHOT_USE_CDN_DOMAIN"}),": ",(0,t.jsx)(r.code,{children:"false"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"SNAPSHOT_COMPRESSION_ALGORITHM"}),": ",(0,t.jsx)(r.code,{children:"zstandard"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"ZSTANDARD_PARAMETERS__LEVEL"}),": ",(0,t.jsx)(r.code,{children:"9"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"ZSTANDARD_PARAMETERS__NUMBER_OF_WORKERS"}),": ",(0,t.jsx)(r.code,{children:"4"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"ANCILLARY_FILES_SIGNER_CONFIG"}),": ",(0,t.jsx)(r.code,{children:"**YOUR_SECRET**"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Cardano transaction configuration"}),":"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"CARDANO_TRANSACTIONS_PROVER_CACHE_POOL_SIZE"}),": ",(0,t.jsx)(r.code,{children:"10"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"CARDANO_TRANSACTIONS_DATABASE_CONNECTION_POOL_SIZE"}),": ",(0,t.jsx)(r.code,{children:"10"})]}),"\n"]}),"\n"]}),"\n"]})]}),"\n",(0,t.jsx)(r.p,{children:"First, create an environment file that the service will use:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat > /opt/mithril/mithril-aggregator.env << EOF\n# Base configuration\nSIGNED_ENTITY_TYPES=**YOUR_SIGNED_ENTITY_TYPES**\nSERVER_PORT=**YOUR_SERVER_PORT**\nPUBLIC_SERVER_URL=**YOUR_PUBLIC_SERVER_URL**\nLEADER_AGGREGATOR_ENDPOINT=**YOUR_LEADER_AGGREGATOR_ENDPOINT**\nRUN_INTERVAL=**YOUR_RUN_INTERVAL**\nAGGREGATE_SIGNATURE_TYPE=**YOUR_AGGREGATE_SIGNATURE_TYPE**\nSTORE_RETENTION_LIMIT=**YOUR_STORE_RETENTION_LIMIT**\nNETWORK=**YOUR_NETWORK**\nNETWORK_MAGIC=**YOUR_NETWORK_MAGIC**\nCARDANO_NODE_SOCKET_PATH=**YOUR_CARDANO_NODE_SOCKET_PATH**\nCARDANO_NODE_VERSION=**YOUR_CARDANO_IMAGE_ID**\nCHAIN_OBSERVER_TYPE=**YOUR_CHAIN_OBSERVER_TYPE**\nERA_READER_ADAPTER_TYPE=**YOUR_ERA_READER_ADAPTER_TYPE**\nERA_READER_ADAPTER_PARAMS=**YOUR_ERA_READER_ADAPTER_PARAMS**\nGENESIS_VERIFICATION_KEY=**YOUR_GENESIS_VERIFICATION_KEY**\nDMQ_NODE_SOCKET_PATH=**YOUR_DMQ_NODE_SOCKET_PATH**\nCUSTOM_ORIGIN_TAG_WHITE_LIST=**YOUR_CUSTOM_ORIGIN_TAG_WHITE_LIST**\nEOF'\n"})}),"\n",(0,t.jsxs)(r.p,{children:["If you want to configure ",(0,t.jsx)(r.strong,{children:"Optional"})," parameters, append the following variables to the ",(0,t.jsx)(r.code,{children:"/opt/mithril/mithril-aggregator.env"})," file:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-aggregator.env << EOF\n# Optional configuration\nBLOCKFROST_PARAMETERS=**YOUR_BLOCKFROST_PARAMETERS**\nSIGNER_IMPORTER_RUN_INTERVAL=**YOUR_SIGNER_IMPORTER_RUN_INTERVAL**\nEOF`\n"})}),"\n",(0,t.jsxs)(r.p,{children:["If you want to support ",(0,t.jsx)(r.strong,{children:"Cardano database v2"})," certification, append the following variables to the ",(0,t.jsx)(r.code,{children:"/opt/mithril/mithril-aggregator.env"})," file:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-aggregator.env << EOF\n# Cardano database configuration\nDB_DIRECTORY=**YOUR_DB_DIRECTORY**\nDATA_STORES_DIRECTORY=**YOUR_DATA_STORES_DIRECTORY**\nGOOGLE_APPLICATION_CREDENTIALS_JSON=**YOUR_GOOGLE_APPLICATION_CREDENTIALS_JSON**\nGOOGLE_APPLICATION_CREDENTIALS_GCP_KMS_JSON=**YOUR_GOOGLE_APPLICATION_CREDENTIALS_GCP_KMS_JSON**\nSNAPSHOT_UPLOADER_TYPE=**YOUR_SNAPSHOT_UPLOADER_TYPE**\nSNAPSHOT_BUCKET_NAME=**YOUR_SNAPSHOT_BUCKET_NAME**\nSNAPSHOT_USE_CDN_DOMAIN=**YOUR_SNAPSHOT_USE_CDN_DOMAIN**\nSNAPSHOT_COMPRESSION_ALGORITHM=**YOUR_SNAPSHOT_COMPRESSION_ALGORITHM**\nZSTANDARD_PARAMETERS__LEVEL=**YOUR_ZSTANDARD_PARAMETERS__LEVEL**\nZSTANDARD_PARAMETERS__NUMBER_OF_WORKERS=**YOUR_ZSTANDARD_PARAMETERS__NUMBER_OF_WORKERS**\nANCILLARY_FILES_SIGNER_CONFIG=**YOUR_ANCILLARY_FILES_SIGNER_CONFIG**\nEOF`\n"})}),"\n",(0,t.jsxs)(r.p,{children:["If you want to support ",(0,t.jsx)(r.strong,{children:"Cardano transaction"})," certification, append the following variables to the ",(0,t.jsx)(r.code,{children:"/opt/mithril/mithril-aggregator.env"})," file:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-aggregator.env << EOF\n# Cardano transactions configuration\nCARDANO_TRANSACTIONS_PROVER_CACHE_POOL_SIZE=**YOUR_CARDANO_TRANSACTIONS_PROVER_CACHE_POOL_SIZE**\nCARDANO_TRANSACTIONS_DATABASE_CONNECTION_POOL_SIZE=**YOUR_CARDANO_TRANSACTIONS_DATABASE_CONNECTION_POOL_SIZE**\nEOF`\n"})}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsxs)(r.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,t.jsx)(r.code,{children:"release-preprod"}),":"]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'sudo bash -c \'cat > /opt/mithril/mithril-aggregator.env << EOF\n# Base configuration\nSIGNED_ENTITY_TYPES=MithrilStakeDistribution,CardanoStakeDistribution,CardanoTransactions\nSERVER_PORT=8080\nPUBLIC_SERVER_URL=https://aggregator.example.com/aggregator\nLEADER_AGGREGATOR_ENDPOINT=https://aggregator.release-preprod.api.mithril.network/aggregator\nRUN_INTERVAL=60000\nAGGREGATE_SIGNATURE_TYPE=Concatenation\nSTORE_RETENTION_LIMIT=5\nNETWORK=preprod\nNETWORK_MAGIC=1\nCARDANO_NODE_SOCKET_PATH=/cardano/ipc/node.socket\nCARDANO_NODE_VERSION=10.5.0\nCHAIN_OBSERVER_TYPE=pallas\nERA_READER_ADAPTER_TYPE=cardano-chain\nERA_READER_ADAPTER_PARAMS={"address": "addr_test1qpkyv2ws0deszm67t840sdnruqgr492n80g3y96xw3p2ksk6suj5musy6w8lsg3yjd09cnpgctc2qh386rtxphxt248qr0npnx", "verification_key": "5b35352c3232382c3134342c38372c3133382c3133362c34382c382c31342c3138372c38352c3134382c39372c3233322c3235352c3232392c33382c3234342c3234372c3230342c3139382c31332c33312c3232322c32352c3136342c35322c3130322c39312c3132302c3230382c3134375d"}\nDMQ_NODE_SOCKET_PATH=/dmq/ipc/node.socket\nCUSTOM_ORIGIN_TAG_WHITE_LIST=EXPLORER,BENCHMARK,CI,NA\nEOF\'\n'})}),(0,t.jsxs)(r.p,{children:["If you want to configure ",(0,t.jsx)(r.strong,{children:"Optional"})," parameters, append the following variables to the ",(0,t.jsx)(r.code,{children:"/opt/mithril/mithril-aggregator.env"})," file:"]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'sudo bash -c \'cat >> /opt/mithril/mithril-aggregator.env << EOF\n# Optional configuration\nBLOCKFROST_PARAMETERS={"project_id":"preprodWuV1ICdtOWfZYfdcxpZ0tsS1N9rVZomQ"}\nSIGNER_IMPORTER_RUN_INTERVAL=720\nEOF\'\n'})}),(0,t.jsxs)(r.p,{children:["If you want to support the ",(0,t.jsx)(r.strong,{children:"Cardano database"})," certification, append the following variables to the ",(0,t.jsx)(r.code,{children:"/opt/mithril/mithril-aggregator.env"})," file:"]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'sudo bash -c \'cat >> /opt/mithril/mithril-aggregator.env << EOF\n# Cardano database configuration\nDB_DIRECTORY=/cardano/db\nDATA_STORES_DIRECTORY=/opt/mithril/stores\nGOOGLE_APPLICATION_CREDENTIALS_JSON=**YOUR_SECRET**\nGOOGLE_APPLICATION_CREDENTIALS_GCP_KMS_JSON=**YOUR_SECRET**\nSNAPSHOT_UPLOADER_TYPE=local\nSNAPSHOT_BUCKET_NAME=mithril-snapshots\nSNAPSHOT_USE_CDN_DOMAIN=false\nSNAPSHOT_COMPRESSION_ALGORITHM=zstandard\nZSTANDARD_PARAMETERS__LEVEL=9\nZSTANDARD_PARAMETERS__NUMBER_OF_WORKERS=4\nANCILLARY_FILES_SIGNER_CONFIG={"type": "secret-key", "secret_key": "**YOUR_SECRET**"}\nEOF\'\n'})}),(0,t.jsxs)(r.p,{children:["If you want to support ",(0,t.jsx)(r.strong,{children:"Cardano transaction"})," certification, append the following variables to the ",(0,t.jsx)(r.code,{children:"/opt/mithril/mithril-aggregator.env"})," file:"]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-aggregator.env << EOF\n# Cardano transactions configuration\nCARDANO_TRANSACTIONS_PROVER_CACHE_POOL_SIZE=10\nCARDANO_TRANSACTIONS_DATABASE_CONNECTION_POOL_SIZE=10\nEOF'\n"})})]}),"\n",(0,t.jsxs)(r.p,{children:["Then, create a ",(0,t.jsx)(r.code,{children:"/etc/systemd/system/mithril-aggregator.service"})," description file for the service:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat > /etc/systemd/system/mithril-aggregator.service << EOF\n[Unit]\nDescription=Mithril aggregator service\nStartLimitIntervalSec=0\n\n[Service]\nType=simple\nRestart=always\nRestartSec=60\nUser=cardano\nEnvironmentFile=/opt/mithril/mithril-aggregator.env\nExecStart=/opt/mithril/mithril-aggregator -vvv\n\n[Install]\nWantedBy=multi-user.target\nEOF'\n"})}),"\n",(0,t.jsx)(r.p,{children:"Reload the service configuration (optional):"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo systemctl daemon-reload\n"})}),"\n",(0,t.jsx)(r.p,{children:"Then, start the service:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo systemctl start mithril-aggregator\n"})}),"\n",(0,t.jsx)(r.p,{children:"Register the service to start on boot:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo systemctl enable mithril-aggregator\n"})}),"\n",(0,t.jsx)(r.p,{children:"Monitor the status of the service:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"systemctl status mithril-aggregator.service\n"})}),"\n",(0,t.jsx)(r.p,{children:"Finally, monitor the logs of the service:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"tail -f /var/log/syslog | grep mithril-aggregator\n"})}),"\n",(0,t.jsx)(r.h3,{id:"activate-a-prometheus-endpoint",children:"Activate a Prometheus endpoint"}),"\n",(0,t.jsx)(r.p,{children:"The Mithril aggregator node can expose basic metrics on a Prometheus endpoint, which is not activated by default."}),"\n",(0,t.jsxs)(r.table,{children:[(0,t.jsx)(r.thead,{children:(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.th,{children:"Metrics"}),(0,t.jsx)(r.th,{children:"Description"})]})}),(0,t.jsxs)(r.tbody,{children:[(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_certificate_detail_total_served_since_startup"})}),(0,t.jsx)(r.td,{children:"Certificate details served since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_artifact_detail_cardano_db_total_served_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano immutable files full artifact details served since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_cardano_db_total_restoration_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano immutable files full restorations since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_cardano_db_immutable_files_restored_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano immutable files restored since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_cardano_db_ancillary_files_restored_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano ancillary files restored since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_cardano_db_complete_restoration_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of complete Cardano database restorations since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_cardano_db_partial_restoration_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of partial Cardano database restorations since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_artifact_detail_cardano_database_total_served_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano database artifact details served since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_artifact_detail_mithril_stake_distribution_total_served_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Mithril stake distribution artifact details served since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_artifact_detail_cardano_stake_distribution_total_served_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano stake distribution artifact details served since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_artifact_detail_cardano_transaction_total_served_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano transaction artifact details served since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_proof_cardano_transaction_total_proofs_served_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano transaction proofs served since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_proof_cardano_transaction_total_transactions_served_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano transaction hashes requested for proof since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_signer_registration_total_received_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of signer registrations received since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_signer_registration_total_successful_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of successful signer registrations received since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_signature_registration_total_received_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of signature registrations received since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_signature_registration_total_successful_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of successful signature registrations received since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_certificate_total_produced_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of certificates produced since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_artifact_cardano_db_total_produced_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano immutable files full artifacts produced since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_artifact_cardano_database_total_produced_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano database artifacts produced since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_artifact_mithril_stake_distribution_total_produced_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Mithril stake distribution artifacts produced since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_artifact_cardano_stake_distribution_total_produced_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano stake distribution artifacts produced since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_artifact_cardano_transaction_total_produced_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of Cardano transaction artifacts produced since startup on a Mithril aggregator node"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_runtime_cycle_success_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of successful runtime cycles since startup on a Mithril aggregator"})]}),(0,t.jsxs)(r.tr,{children:[(0,t.jsx)(r.td,{children:(0,t.jsx)(r.strong,{children:"mithril_aggregator_runtime_cycle_total_since_startup"})}),(0,t.jsx)(r.td,{children:"Number of runtime cycles since startup on a Mithril aggregator"})]})]})]}),"\n",(0,t.jsxs)(r.p,{children:["To expose metrics on the endpoint, append the following environment variable to your environment file. In that case, the metrics server will listen on the ",(0,t.jsx)(r.code,{children:"9090"})," port:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-aggregator.env << EOF\nENABLE_METRICS_SERVER=true\nEOF`\n"})}),"\n",(0,t.jsx)(r.p,{children:"You can also specify a custom listen IP address and port for the metrics server:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-aggregator.env << EOF\nENABLE_METRICS_SERVER=true\nMETRICS_SERVER_IP=**YOUR_METRICS_SERVER_IP**\nMETRICS_SERVER_PORT=**YOUR_METRICS_SERVER_PORT**\nEOF`\n"})}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsx)(r.p,{children:"Here is an example that reproduces the default configuration for the Prometheus server:"}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-aggregator.env << EOF\nENABLE_METRICS_SERVER=true\nMETRICS_SERVER_IP=0.0.0.0\nMETRICS_SERVER_PORT=9090\nEOF`\n"})})]}),"\n",(0,t.jsx)(r.admonition,{type:"info",children:(0,t.jsxs)(r.p,{children:["When activated, the metrics endpoint will be accessible to the ",(0,t.jsx)(r.code,{children:"http://**YOUR_METRICS_SERVER_IP**:**YOUR_METRICS_SERVER_PORT**/metrics"})," location, which translates to ",(0,t.jsx)(r.a,{href:"http://0.0.0.0:9090/metrics",children:(0,t.jsx)(r.code,{children:"http://0.0.0.0:9090/metrics"})})," with the default configuration."]})}),"\n",(0,t.jsx)(r.admonition,{type:"info",children:(0,t.jsxs)(r.p,{children:["This ",(0,t.jsx)(r.a,{href:"https://grafana.com/grafana/dashboards/22165-mithril-aggregator/",children:"Grafana template"})," makes it easy to set up a dashboard for this Prometheus endpoint (ID 22165)."]})}),"\n",(0,t.jsx)(r.h2,{id:"set-up-the-ssl-certificate-traefik",children:"Set up the SSL certificate (Traefik)"}),"\n",(0,t.jsx)(r.p,{children:"An aggregator must expose a TLS/SSL endpoint to securely communicate with Mithril signers. You can use a self-signed certificate or a certificate issued by a trusted Certificate Authority (CA)."}),"\n",(0,t.jsxs)(r.p,{children:["We recommend using a reverse proxy such as ",(0,t.jsx)(r.a,{href:"https://doc.traefik.io/traefik/",children:"Traefik"}),", which can automatically generate and renew SSL certificates using ",(0,t.jsx)(r.a,{href:"https://letsencrypt.org/",children:"Let's Encrypt"})," at no charge."]}),"\n",(0,t.jsxs)(r.admonition,{type:"caution",children:[(0,t.jsx)(r.p,{children:"Here is the needed information to set up Traefik:"}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"**YOUR_TRAEFIK_HTTP_PORT**"}),": replace with the HTTP port for Traefik (typically ",(0,t.jsx)(r.code,{children:"80"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"**YOUR_TRAEFIK_HTTPS_PORT**"}),": replace with the HTTPS port for Traefik (typically ",(0,t.jsx)(r.code,{children:"443"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"**YOUR_DOMAIN_NAME**"}),": replace with your aggregator's domain name (eg, ",(0,t.jsx)(r.code,{children:"aggregator.example.com"}),")"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"**YOUR_EMAIL**"}),": replace with your email address for Let's Encrypt notifications"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"**YOUR_AGGREGATOR_PORT**"}),": replace with the port your Mithril aggregator listens on (from ",(0,t.jsx)(r.code,{children:"SERVER_PORT"})," in the aggregator environment file)."]}),"\n"]})]}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsxs)(r.p,{children:["Here is an ",(0,t.jsx)(r.strong,{children:"example"})," set of values that will be used in this guide in the ",(0,t.jsx)(r.strong,{children:"tip"})," boxes to illustrate some commands:"]}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"YOUR_TRAEFIK_HTTP_PORT"}),": ",(0,t.jsx)(r.code,{children:"80"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"YOUR_TRAEFIK_HTTPS_PORT"}),": ",(0,t.jsx)(r.code,{children:"443"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"YOUR_DOMAIN_NAME"}),": ",(0,t.jsx)(r.code,{children:"aggregator.example.com"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"YOUR_EMAIL"}),": ",(0,t.jsx)(r.code,{children:"admin@example.com"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"YOUR_AGGREGATOR_PORT"}),": ",(0,t.jsx)(r.code,{children:"8080"}),"."]}),"\n"]})]}),"\n",(0,t.jsx)(r.h3,{id:"download-the-pre-built-binary-1",children:"Download the pre-built binary"}),"\n",(0,t.jsx)(r.p,{children:"To download the latest released version of Traefik, first determine the latest version:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'TRAEFIK_VERSION=$(curl -s https://api.github.com/repos/traefik/traefik/releases/latest | grep \'"tag_name":\' | sed -E \'s/.*"v([^"]+)".*/\\1/\')\n'})}),"\n",(0,t.jsx)(r.p,{children:"Then, download the binary:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"curl -L -o traefik.tar.gz https://github.com/traefik/traefik/releases/download/v${TRAEFIK_VERSION}/traefik_v${TRAEFIK_VERSION}_linux_amd64.tar.gz\n"})}),"\n",(0,t.jsx)(r.p,{children:"Extract the archive:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"tar -xzf traefik.tar.gz\n"})}),"\n",(0,t.jsx)(r.h3,{id:"installing-the-service-1",children:"Installing the service"}),"\n",(0,t.jsx)(r.h4,{id:"make-the-binary-executable",children:"Make the binary executable"}),"\n",(0,t.jsx)(r.p,{children:"To make the binary executable, run:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"chmod +x traefik\n"})}),"\n",(0,t.jsx)(r.h4,{id:"move-the-executable-1",children:"Move the executable"}),"\n",(0,t.jsx)(r.p,{children:"To move the executable to /opt/traefik, run:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo mkdir -p /opt/traefik\nsudo mv traefik /opt/traefik\n"})}),"\n",(0,t.jsx)(r.h4,{id:"prepare-the-configuration-directories",children:"Prepare the configuration directories"}),"\n",(0,t.jsx)(r.p,{children:"Create the necessary directories for Traefik configuration and certificates:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo mkdir -p /opt/traefik/config\nsudo mkdir -p /opt/traefik/letsencrypt\n"})}),"\n",(0,t.jsx)(r.h4,{id:"prepare-the-static-configuration-file",children:"Prepare the static configuration file"}),"\n",(0,t.jsxs)(r.p,{children:["Create a ",(0,t.jsx)(r.code,{children:"/opt/traefik/traefik.yml"})," static configuration file:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'sudo bash -c \'cat > /opt/traefik/traefik.yml << EOF\nentryPoints:\n  web:\n    address: ":**YOUR_TRAEFIK_HTTP_PORT**"\n    http:\n      redirections:\n        entryPoint:\n          to: websecure\n          scheme: https\n  websecure:\n    address: ":**YOUR_TRAEFIK_HTTPS_PORT**"\n    http:\n      tls:\n        certResolver: letsencrypt\n\ncertificatesResolvers:\n  letsencrypt:\n    acme:\n      email: **YOUR_EMAIL**\n      storage: /opt/traefik/letsencrypt/acme.json\n      httpChallenge:\n        entryPoint: web\n\nproviders:\n  file:\n    directory: /opt/traefik/config\n    watch: true\n\nlog:\n  level: INFO\n\naccessLog: {}\nEOF\'\n'})}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsx)(r.p,{children:"Here is an example of the aforementioned command created with the example set:"}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'sudo bash -c \'cat > /opt/traefik/traefik.yml << EOF\nentryPoints:\n  web:\n    address: ":80"\n    http:\n      redirections:\n        entryPoint:\n          to: websecure\n          scheme: https\n  websecure:\n    address: ":443"\n    http:\n      tls:\n        certResolver: letsencrypt\n\ncertificatesResolvers:\n  letsencrypt:\n    acme:\n      email: admin@example.com\n      storage: /opt/traefik/letsencrypt/acme.json\n      httpChallenge:\n        entryPoint: web\n\nproviders:\n  file:\n    directory: /opt/traefik/config\n    watch: true\n\nlog:\n  level: INFO\n\naccessLog: {}\nEOF\'\n'})})]}),"\n",(0,t.jsx)(r.h4,{id:"prepare-the-dynamic-configuration-file",children:"Prepare the dynamic configuration file"}),"\n",(0,t.jsxs)(r.p,{children:["Create a ",(0,t.jsx)(r.code,{children:"/opt/traefik/config/dynamic.yml"})," dynamic configuration file to route traffic to the Mithril aggregator:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'sudo bash -c \'cat > /opt/traefik/config/dynamic.yml << EOF\nhttp:\n  routers:\n    mithril-aggregator:\n      rule: "Host(\\`**YOUR_DOMAIN_NAME**\\`)"\n      service: mithril-aggregator\n      entryPoints:\n        - websecure\n      tls:\n        certResolver: letsencrypt\n\n  services:\n    mithril-aggregator:\n      loadBalancer:\n        servers:\n          - url: "http://localhost:**YOUR_AGGREGATOR_PORT**"\nEOF\'\n'})}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsx)(r.p,{children:"Here is an example of the aforementioned command created with the example set:"}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'sudo bash -c \'cat > /opt/traefik/config/dynamic.yml << EOF\nhttp:\n  routers:\n    mithril-aggregator:\n      rule: "Host(\\`aggregator.example.com\\`)"\n      service: mithril-aggregator\n      entryPoints:\n        - websecure\n      tls:\n        certResolver: letsencrypt\n\n  services:\n    mithril-aggregator:\n      loadBalancer:\n        servers:\n          - url: "http://localhost:8080"\nEOF\'\n'})})]}),"\n",(0,t.jsx)(r.h4,{id:"prepare-the-acmejson-file",children:"Prepare the acme.json file"}),"\n",(0,t.jsx)(r.p,{children:"Create and secure the ACME certificates file:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo touch /opt/traefik/letsencrypt/acme.json\nsudo chmod 600 /opt/traefik/letsencrypt/acme.json\n"})}),"\n",(0,t.jsx)(r.h4,{id:"create-the-service-user",children:"Create the service user"}),"\n",(0,t.jsx)(r.p,{children:"Create a dedicated system user for Traefik:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo useradd -r -s /usr/sbin/nologin traefik\n"})}),"\n",(0,t.jsx)(r.p,{children:"Set appropriate ownership for the Traefik directories:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo chown -R traefik:traefik /opt/traefik\n"})}),"\n",(0,t.jsx)(r.h4,{id:"set-up-the-service-1",children:"Set up the service"}),"\n",(0,t.jsx)(r.admonition,{type:"caution",children:(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"User=traefik"}),":\nReplace this value with the correct user if you use a different username. The service uses Linux capabilities (",(0,t.jsx)(r.code,{children:"CAP_NET_BIND_SERVICE"}),") to allow the non-root user to bind to privileged ports (80 and 443) without requiring full root privileges."]}),"\n"]})}),"\n",(0,t.jsxs)(r.p,{children:["Create a ",(0,t.jsx)(r.code,{children:"/etc/systemd/system/traefik.service"})," description file for the service:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat > /etc/systemd/system/traefik.service << EOF\n[Unit]\nDescription=Traefik reverse proxy\nAfter=network-online.target\nWants=network-online.target\nStartLimitIntervalSec=0\n\n[Service]\nType=simple\nRestart=always\nRestartSec=60\nUser=traefik\nGroup=traefik\nCapabilityBoundingSet=CAP_NET_BIND_SERVICE\nAmbientCapabilities=CAP_NET_BIND_SERVICE\nProtectHome=true\nProtectSystem=full\nPrivateTmp=true\nNoNewPrivileges=true\nExecStart=/opt/traefik/traefik --configFile=/opt/traefik/traefik.yml\n\n[Install]\nWantedBy=multi-user.target\nEOF'\n"})}),"\n",(0,t.jsx)(r.p,{children:"Reload the service configuration (optional):"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo systemctl daemon-reload\n"})}),"\n",(0,t.jsx)(r.p,{children:"Then, start the service:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo systemctl start traefik\n"})}),"\n",(0,t.jsx)(r.p,{children:"Register the service to start on boot:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo systemctl enable traefik\n"})}),"\n",(0,t.jsx)(r.p,{children:"Monitor the status of the service:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"systemctl status traefik.service\n"})}),"\n",(0,t.jsx)(r.p,{children:"Finally, monitor the logs of the service:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"tail -f /var/log/syslog | grep traefik\n"})}),"\n",(0,t.jsx)(r.admonition,{type:"info",children:(0,t.jsx)(r.p,{children:"Make sure your domain name points to your server's public IP address and that ports 80 and 443 are accessible from the internet for Let's Encrypt certificate validation and HTTPS access."})}),"\n",(0,t.jsx)(r.h2,{id:"set-up-the-dmq-node-unstable",children:"Set up the DMQ node (unstable)"}),"\n",(0,t.jsxs)(r.admonition,{type:"danger",children:[(0,t.jsxs)(r.p,{children:["The DMQ node setup is currently ",(0,t.jsx)(r.strong,{children:"unstable"})," and not suitable for production use."]}),(0,t.jsx)(r.p,{children:"During the stabilization and ramp-up phase of the DMQ network:"}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Signatures are still sent to the central aggregator (using the DMQ node is harmless)"}),"\n",(0,t.jsx)(r.li,{children:"This section is subject to frequent changes."}),"\n"]})]}),"\n",(0,t.jsxs)(r.p,{children:["The DMQ node supports the implementation of a ",(0,t.jsx)(r.strong,{children:"Decentralized Message Queue"})," (DMQ) for Mithril. The DMQ protocol allows Mithril signers to exchange signatures in a decentralized manner, enhancing the robustness and scalability of the Mithril networks. Once stabilized and deployed on a majority of SPOs on a Mithril network, the DMQ protocol will allow multiple aggregators to operate simultaneously, improving the overall availability of the Mithril protocol. The DMQ protocol is fully described in the ",(0,t.jsx)(r.a,{href:"https://cips.cardano.org/cip/CIP-0137",children:"CIP-0137"}),"."]}),"\n",(0,t.jsx)(r.admonition,{type:"caution",children:(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Here is the needed information to set up a DMQ node:","\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"**YOUR_DMQ_NODE_SOCKET_PATH**"}),": replace with the path to the IPC file of the DMQ node"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"**YOUR_CARDANO_NODE_SOCKET_PATH**"}),": replace with the path to the IPC file of the Cardano node"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"**YOUR_CARDANO_NETWORK_MAGIC**"}),": replace with the network magic number of your Cardano network"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"**YOUR_DMQ_NODE_PUBLIC_ADDRESS**"}),": replace with the ",(0,t.jsx)(r.strong,{children:"public"})," IP address of your DMQ node"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"**YOUR_DMQ_NODE_PORT**"}),": replace with the listening port of your DMQ node"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"**YOUR_DMQ_BOOTSTRAP_PEER_ADDRESS**"}),": replace with the IP address of your DMQ bootstrap peer (the address can be found in the ",(0,t.jsx)(r.a,{href:"/doc/next/manual/getting-started/network-configurations",children:"Mithril networks"})," table)"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"**YOUR_DMQ_BOOTSTRAP_PEER_PORT**"}),": replace with the listening port of your DMQ bootstrap peer (the value can be found in the ",(0,t.jsx)(r.a,{href:"/doc/next/manual/getting-started/network-configurations",children:"Mithril networks"})," table)."]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsxs)(r.p,{children:["Here is an ",(0,t.jsx)(r.strong,{children:"example"})," set of values for ",(0,t.jsx)(r.strong,{children:"pre-release-preview"})," that will be used in this guide in the ",(0,t.jsx)(r.strong,{children:"tip"})," boxes to illustrate some commands:"]}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"YOUR_DMQ_NODE_SOCKET_PATH"}),": ",(0,t.jsx)(r.code,{children:"/dmq/ipc/node.socket"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"YOUR_CARDANO_NODE_SOCKET_PATH"}),": ",(0,t.jsx)(r.code,{children:"/cardano/ipc/node.socket"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"YOUR_CARDANO_NETWORK_MAGIC"}),": ",(0,t.jsx)(r.code,{children:"2"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"YOUR_DMQ_NODE_PUBLIC_ADDRESS"}),": ",(0,t.jsx)(r.code,{children:"34.14.65.160"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"YOUR_DMQ_NODE_PORT"}),": ",(0,t.jsx)(r.code,{children:"6161"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"YOUR_DMQ_BOOTSTRAP_PEER_ADDRESS"}),": ",(0,t.jsx)(r.code,{children:"34.76.22.193"})]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"YOUR_DMQ_BOOTSTRAP_PEER_PORT"}),": ",(0,t.jsx)(r.code,{children:"11001"}),"."]}),"\n"]})]}),"\n",(0,t.jsx)(r.h3,{id:"download-the-pre-built-binary-2",children:"Download the pre-built binary"}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsxs)(r.p,{children:["As we are still in a testing stage, we only support the ",(0,t.jsx)(r.code,{children:"pre-release-preview"})," network."]}),(0,t.jsxs)(r.p,{children:["You can use these parameters for the ",(0,t.jsx)(r.strong,{children:"pre-release-preview"})," network:"]}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"DMQ_RELEASE_URL"}),": ",(0,t.jsx)(r.code,{children:"https://github.com/IntersectMBO/dmq-node/releases/download/0.2.0.0-pre-7/dmq-node-linux.tar.gz"})]}),"\n"]}),(0,t.jsx)(r.p,{children:(0,t.jsx)(r.em,{children:"These URLs may change in the future; please refer to this page for the latest released version of the DMQ node binary."})})]}),"\n",(0,t.jsx)(r.p,{children:"To download the latest released version of the DMQ node binary, run the following command:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"curl --fail -sL -o dmq-node.tar.gz **DMQ_RELEASE_URL**\n"})}),"\n",(0,t.jsx)(r.p,{children:"Then, extract the archive:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"tar -xzf dmq-node.tar.gz --strip-components=2 result/bin\n"})}),"\n",(0,t.jsx)(r.p,{children:"And test that the binary works:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"./dmq-node --version\n"})}),"\n",(0,t.jsx)(r.p,{children:"You should see something like:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"dmq-node version: 0.2.0.0\n"})}),"\n",(0,t.jsx)(r.h3,{id:"installing-the-service-2",children:"Installing the service"}),"\n",(0,t.jsx)(r.h4,{id:"move-the-executable-2",children:"Move the executable"}),"\n",(0,t.jsx)(r.p,{children:"To move the executable to /opt/dmq, run:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo mkdir -p /opt/dmq\nsudo mv dmq-node /opt/dmq\n"})}),"\n",(0,t.jsx)(r.h4,{id:"prepare-the-configuration-file-of-the-dmq-node",children:"Prepare the configuration file of the DMQ node"}),"\n",(0,t.jsxs)(r.p,{children:["Create a ",(0,t.jsx)(r.code,{children:"/opt/dmq/config.json"})," configuration file:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'bash -c \'cat > /opt/dmq/config.json << EOF\n{\n  "CardanoNetworkMagic": **YOUR_CARDANO_NETWORK_MAGIC**,\n  "CardanoNodeSocket": "**YOUR_CARDANO_NODE_SOCKET_PATH**"\n  "PeerSharing": true,\n  "LocalMsgSubmissionTracer": true,\n  "LocalMsgNotificationTracer": true,\n  "ConnectionManagerTracer": true,\n  "DiffusionTracer": true,\n  "InboundGovernorTracer": true,\n  "LocalInboundGovernorTracer": true,\n  "PeerSelectionTracer": true,\n  "PeerSelectionCounters": true,\n  "SigSubmissionLogicTracer": true,\n  "SigSubmissionClientTracer": true,\n  "SigSubmissionServerTracer": true,\n  "SigSubmissionClientProtocolTracer": true,\n  "SigSubmissionServerProtocolTracer": true,\n  "MuxTracer": true,\n  "ChannelTracer": false,\n  "DebugPeerSelectionTracer": true,\n  "ValidationTracer": true\n}\nEOF\'\n'})}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsxs)(r.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,t.jsx)(r.code,{children:"pre-release-preview"}),":"]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'bash -c \'cat > /opt/dmq/config.json << EOF\n{\n  "CardanoNetworkMagic": 2,\n  "CardanoNodeSocket": "/cardano/ipc/node.socket"\n  "PeerSharing": true,\n  "LocalMsgSubmissionTracer": true,\n  "LocalMsgNotificationTracer": true,\n  "ConnectionManagerTracer": true,\n  "DiffusionTracer": true,\n  "InboundGovernorTracer": true,\n  "LocalInboundGovernorTracer": true,\n  "PeerSelectionTracer": true,\n  "PeerSelectionCounters": true,\n  "SigSubmissionLogicTracer": true,\n  "SigSubmissionClientTracer": true,\n  "SigSubmissionServerTracer": true,\n  "SigSubmissionClientProtocolTracer": true,\n  "SigSubmissionServerProtocolTracer": true,\n  "MuxTracer": true,\n  "ChannelTracer": false,\n  "DebugPeerSelectionTracer": true,\n  "ValidationTracer": true\n}\nEOF\'\n'})})]}),"\n",(0,t.jsx)(r.h4,{id:"prepare-the-topology-file-for-the-dmq-node",children:"Prepare the topology file for the DMQ node"}),"\n",(0,t.jsx)(r.admonition,{type:"tip",children:(0,t.jsxs)(r.p,{children:["The topology file of the DMQ node follows a similar format to the Cardano node topology file. More information is available at ",(0,t.jsx)(r.a,{href:"https://developers.cardano.org/docs/get-started/infrastructure/node/topology/",children:"Cardano node topology"}),"."]})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Create a ",(0,t.jsx)(r.code,{children:"/opt/dmq/topology.json"})," configuration file:"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'bash -c \'cat > /opt/dmq/topology.json << EOF\n{\n  "bootstrapPeers": [],\n  "localRoots": [\n    {\n      "accessPoints": [\n        {\n          "address": "**YOUR_DMQ_BOOTSTRAP_PEER_ADDRESS**",\n          "port": **YOUR_DMQ_BOOTSTRAP_PEER_PORT**,\n          "valency": 1\n        }\n      ],\n      "advertise": true,\n      "trustable": false,\n      "valency": 2\n    }\n  ],\n  "peerSnapshotFile": null,\n  "publicRoots": [\n    {\n      "accessPoints": [],\n      "advertise": false\n    }\n  ]\n}\nEOF\'\n'})}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsxs)(r.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,t.jsx)(r.code,{children:"pre-release-preview"}),":"]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'bash -c \'cat > /opt/dmq/topology.json << EOF\n{\n  "bootstrapPeers": [],\n  "localRoots": [\n    {\n      "accessPoints": [\n        {\n          "address": "34.76.22.193",\n          "port": 11001,\n          "valency": 1\n        }\n      ],\n      "advertise": true,\n      "trustable": false,\n      "valency": 2\n    }\n  ],\n  "peerSnapshotFile": null,\n  "publicRoots": [\n    {\n      "accessPoints": [],\n      "advertise": false\n    }\n  ]\n}\nEOF\'\n'})})]}),"\n",(0,t.jsx)(r.h4,{id:"set-up-the-service-2",children:"Set up the service"}),"\n",(0,t.jsx)(r.admonition,{type:"caution",children:(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.code,{children:"User=cardano"}),":\nReplace this value with the correct user. We assume that the user running the ",(0,t.jsx)(r.strong,{children:"Cardano node"})," is ",(0,t.jsx)(r.code,{children:"cardano"}),". The ",(0,t.jsx)(r.strong,{children:"DMQ node"})," must imperatively run with the same user."]}),"\n"]})}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Create a ",(0,t.jsx)(r.code,{children:"/etc/systemd/system/dmq-aggregator.service"})," description file for the service:"]}),"\n"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat > /etc/systemd/system/dmq-aggregator.service << EOF\n[Unit]\nDescription=DMQ aggregator service\nStartLimitIntervalSec=0\n\n[Service]\nType=simple\nRestart=always\nRestartSec=60\nUser=cardano\nExecStart=/opt/dmq/dmq-node --configuration-file /opt/dmq/config.json --topology-file /opt/dmq/topology.json --local-socket **YOUR_DMQ_NODE_SOCKET_PATH** --host-addr **YOUR_DMQ_NODE_PUBLIC_ADDRESS** --port **YOUR_DMQ_NODE_PORT**\n\n[Install]\nWantedBy=multi-user.target\nEOF'\n"})}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsxs)(r.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,t.jsx)(r.code,{children:"pre-release-preview"}),":"]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat > /etc/systemd/system/dmq-aggregator.service << EOF\n[Unit]\nDescription=DMQ aggregator service\nStartLimitIntervalSec=0\n\n[Service]\nType=simple\nRestart=always\nRestartSec=60\nUser=cardano\nExecStart=/opt/dmq/dmq-node --configuration-file /opt/dmq/config.json --topology-file /opt/dmq/topology.json --local-socket /dmq/ipc/node.socket --host-addr 34.14.65.160 --port 11001\n[Install]\nWantedBy=multi-user.target\nEOF'\n"})})]}),"\n",(0,t.jsx)(r.p,{children:"Reload the service configuration (optional):"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo systemctl daemon-reload\n"})}),"\n",(0,t.jsx)(r.p,{children:"Then, start the service:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo systemctl start dmq-aggregator\n"})}),"\n",(0,t.jsx)(r.p,{children:"Register the service to start on boot:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo systemctl enable dmq-aggregator\n"})}),"\n",(0,t.jsx)(r.p,{children:"Monitor the status of the service:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"systemctl status dmq-aggregator.service\n"})}),"\n",(0,t.jsx)(r.p,{children:"Finally, monitor the logs of the service:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"tail -f /var/log/syslog | grep dmq-aggregator\n"})}),"\n",(0,t.jsx)(r.h3,{id:"update-the-configuration-of-the-mithril-aggregator",children:"Update the configuration of the Mithril aggregator"}),"\n",(0,t.jsx)(r.p,{children:"If you have set up the DMQ node, the Mithril aggregator must be configured to use it. Add the DMQ node socket path to the aggregator configuration:"}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-aggregator.env << EOF\nDMQ_NODE_SOCKET_PATH=**YOUR_DMQ_NODE_SOCKET_PATH**\nEOF'\n"})}),"\n",(0,t.jsxs)(r.admonition,{type:"tip",children:[(0,t.jsxs)(r.p,{children:["Here is an example of the aforementioned command created with the example set for ",(0,t.jsx)(r.code,{children:"pre-release-preview"}),":"]}),(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:"sudo bash -c 'cat >> /opt/mithril/mithril-aggregator.env << EOF\nDMQ_NODE_SOCKET_PATH=/dmq/ipc/node.socket\nEOF'\n"})})]}),"\n",(0,t.jsx)(r.h2,{id:"verify-the-mithril-aggregator-deployment",children:"Verify the Mithril aggregator deployment"}),"\n",(0,t.jsx)(r.p,{children:"After installing and starting your Mithril aggregator node, you should verify that it is operating correctly. The verification process includes checking that your aggregator is:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsx)(r.li,{children:"Synchronizing signer registrations with the leader aggregator"}),"\n",(0,t.jsx)(r.li,{children:"Synchronizing the certificate chain with the leader aggregator"}),"\n",(0,t.jsx)(r.li,{children:"Producing new certificates."}),"\n"]}),"\n",(0,t.jsxs)(r.admonition,{type:"info",children:[(0,t.jsx)(r.p,{children:"As a follower aggregator, your node will:"}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsx)(r.li,{children:"Fetch and store signer registrations from the leader aggregator"}),"\n",(0,t.jsx)(r.li,{children:"Synchronize the certificate chain from the leader aggregator"}),"\n",(0,t.jsx)(r.li,{children:"Produce its own certificates using signatures collected via the DMQ protocol (once DMQ is stable and widely deployed)."}),"\n"]})]}),"\n",(0,t.jsx)(r.h3,{id:"monitor-your-aggregator-with-the-mithril-explorer",children:"Monitor your aggregator with the Mithril explorer"}),"\n",(0,t.jsxs)(r.p,{children:["You can monitor your aggregator's activity using the ",(0,t.jsx)(r.a,{href:"https://mithril.network/explorer",children:"Mithril explorer"}),". To connect the explorer to your aggregator, use the following URL format:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"https://mithril.network/explorer/?aggregator=**URL_ENCODED_AGGREGATOR_ENDPOINT**\n"})}),"\n",(0,t.jsxs)(r.p,{children:["For example, to monitor the ",(0,t.jsx)(r.code,{children:"release-preprod"})," leader aggregator:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{children:"https://mithril.network/explorer/?aggregator=https%3A%2F%2Faggregator.release-preprod.api.mithril.network%2Faggregator\n"})}),"\n",(0,t.jsx)(r.p,{children:"To monitor your own aggregator, replace the endpoint with your aggregator's public URL (URL-encoded)."}),"\n",(0,t.jsxs)(r.admonition,{type:"info",children:[(0,t.jsx)(r.p,{children:(0,t.jsx)(r.strong,{children:"Aggregator lifecycle during epochs:"})}),(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"At installation epoch"}),": the aggregator will fetch the signer registrations for the next epoch from the leader aggregator"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"At epoch + 1"}),": the aggregator will synchronize the certificate chain from the leader aggregator"]}),"\n",(0,t.jsxs)(r.li,{children:[(0,t.jsx)(r.strong,{children:"At epoch + 2 and onwards"}),": once the DMQ protocol is stable and widely deployed, the aggregator will start producing its own certificates using signatures collected via DMQ."]}),"\n"]})]}),"\n",(0,t.jsx)(r.h3,{id:"register-your-aggregator-for-automatic-discovery-unstable",children:"Register your aggregator for automatic discovery (unstable)"}),"\n",(0,t.jsx)(r.p,{children:"If you want to make your follower aggregator publicly discoverable, you should:"}),"\n",(0,t.jsxs)(r.ol,{children:["\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Ensure your aggregator is accessible via HTTPS"})," by setting up Traefik or another reverse proxy with a valid SSL certificate (as described in the ",(0,t.jsx)(r.a,{href:"#setup-the-ssl-certificate-traefik",children:"Set up the SSL certificate"})," section)."]}),"\n"]}),"\n",(0,t.jsxs)(r.li,{children:["\n",(0,t.jsxs)(r.p,{children:[(0,t.jsx)(r.strong,{children:"Register your aggregator in the networks configuration"}),". You can do this by:"]}),"\n",(0,t.jsxs)(r.ul,{children:["\n",(0,t.jsxs)(r.li,{children:["Opening an issue in the ",(0,t.jsx)(r.a,{href:"https://github.com/input-output-hk/mithril/issues",children:"Mithril GitHub repository"})]}),"\n",(0,t.jsxs)(r.li,{children:["Or by creating a pull request that modifies the ",(0,t.jsx)(r.a,{href:"https://github.com/input-output-hk/mithril/blob/main/networks.json",children:(0,t.jsx)(r.code,{children:"networks.json"})})," file and updates the ",(0,t.jsx)(r.code,{children:"aggregators"})," field in the Cardano network you are targeting."]}),"\n"]}),"\n",(0,t.jsxs)(r.p,{children:["Here is an example command to add an aggregator to the ",(0,t.jsx)(r.code,{children:"release-preprod"})," network configuration:"]}),"\n",(0,t.jsx)(r.pre,{children:(0,t.jsx)(r.code,{className:"language-bash",children:'jq \'.preprod.mithril-networks.release-preprodaggregators += [{"name": "My Aggregator", "endpoint": "https://aggregator.example.com/aggregator"}]\' networks.json > networks.json.tmp && mv networks.json.tmp networks.json\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(r.admonition,{type:"info",children:(0,t.jsx)(r.p,{children:"Registering your aggregator for automatic discovery is optional. Your aggregator will still work and synchronize with the leader aggregator even if it's not publicly registered."})})]})}function g(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,t.jsx)(r,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}}}]);