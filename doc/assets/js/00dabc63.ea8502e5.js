"use strict";(self.webpackChunkmithril_doc=self.webpackChunkmithril_doc||[]).push([[3898],{17087:(e,t,i)=>{i.r(t),i.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>o,metadata:()=>n,toc:()=>d});var n=i(56839),a=i(74848),s=i(28453);const o={slug:9,title:"9. Database migration squashing\n",authors:[{name:"Mithril Team"}],tags:["Accepted"],date:new Date("2025-03-13T00:00:00.000Z")},r=void 0,l={authorsImageUrls:[void 0]},d=[{value:"Status",id:"status",level:2},{value:"Context",id:"context",level:2},{value:"Decision",id:"decision",level:2},{value:"Consequences",id:"consequences",level:2}];function c(e){const t={h2:"h2",li:"li",p:"p",ul:"ul",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(t.h2,{id:"status",children:"Status"}),"\n",(0,a.jsx)(t.p,{children:"Accepted"}),"\n",(0,a.jsx)(t.h2,{id:"context",children:"Context"}),"\n",(0,a.jsx)(t.p,{children:"Over time, many database migrations have accumulated in Mithril nodes. Since these migrations are applied sequentially, the resulting database schema has become difficult to understand and maintain."}),"\n",(0,a.jsx)(t.h2,{id:"decision",children:"Decision"}),"\n",(0,a.jsx)(t.p,{children:"To address this, the team decided to implement migration squashing once too many migrations have accumulated for a store. This process consolidates all existing migrations into a single, equivalent migration."}),"\n",(0,a.jsx)(t.h2,{id:"consequences",children:"Consequences"}),"\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"This applies to the migrations of all Mithril node stores"}),"\n",(0,a.jsx)(t.li,{children:"A squashed migration will be applied when a database is initialized for the first time"}),"\n",(0,a.jsx)(t.li,{children:"A squashed migration must be optional and should only run if it has not been previously applied with the equivalent migration sequence"}),"\n",(0,a.jsxs)(t.li,{children:["Some nodes may have only partially applied the equivalent sequence of migrations and cannot apply the squashed migration immediately:","\n",(0,a.jsxs)(t.ul,{children:["\n",(0,a.jsx)(t.li,{children:"They must first run the migration using the latest distribution that does not include the squashed migration, ensuring their database is prepared to apply it"}),"\n",(0,a.jsx)(t.li,{children:"This distribution is associated with a squashed migration to provide a smooth user experience."}),"\n"]}),"\n"]}),"\n"]})]})}function u(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,a.jsx)(t,{...e,children:(0,a.jsx)(c,{...e})}):c(e)}},28453:(e,t,i)=>{i.d(t,{R:()=>o,x:()=>r});var n=i(96540);const a={},s=n.createContext(a);function o(e){const t=n.useContext(s);return n.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function r(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:o(e.components),n.createElement(s.Provider,{value:t},e.children)}},56839:e=>{e.exports=JSON.parse('{"permalink":"/doc/adr/9","source":"@site/adr/009-database-migration-squashing.md","title":"9. Database migration squashing\\n","description":"Status","date":"2025-03-13T00:00:00.000Z","tags":[{"inline":true,"label":"Accepted","permalink":"/doc/adr/tags/accepted"}],"readingTime":0.84,"hasTruncateMarker":false,"authors":[{"name":"Mithril Team","socials":{},"key":null,"page":null}],"frontMatter":{"slug":"9","title":"9. Database migration squashing\\n","authors":[{"name":"Mithril Team"}],"tags":["Accepted"],"date":"2025-03-13T00:00:00.000Z"},"unlisted":false,"prevItem":{"title":"10. Specific Mithril Http status code\\n","permalink":"/doc/adr/10"},"nextItem":{"title":"8. Standardize JSON Message Testing\\n","permalink":"/doc/adr/8"}}')}}]);